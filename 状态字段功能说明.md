# 活动管理后台 - 状态字段优化说明

## 📋 更新内容

### 1. 状态字段优化

将原有的状态（活跃、已过期、草稿）优化为更符合实际业务流程的状态：

| 原状态 | 新状态 | 英文值 | 颜色 | 说明 |
|--------|--------|--------|------|------|
| - | 📝 草稿 | draft | 灰色 #9E9E9E | 新建活动默认为草稿，可编辑 |
| - | ⏰ 待开始 | pending | 橙色 #FFA726 | 活动已发布但未开始 |
| ✅ 活跃 | 🚀 进行中 | ongoing | 绿色 #66BB6A | 活动正在进行 |
| ❌ 已过期 | 📅 已过期 | expired | 红色 #EF5350 | 活动已结束 |

### 2. 新增功能

#### ✨ "保存为草稿" 按钮

在活动编辑表单中新增了独立的"保存为草稿"按钮：

```
[取消] [📝 保存为草稿] [💾 保存]
```

**功能说明**：
- 点击"保存为草稿"会将活动状态自动设置为 `draft`
- 点击"保存"则根据用户选择的状态保存
- 保存成功后会显示不同的提示消息：
  - 草稿：`✅ 草稿创建成功` / `✅ 草稿更新成功`
  - 其他：`✅ 活动创建成功` / `✅ 活动更新成功`

#### 🎯 默认状态逻辑

- **新增活动**：默认状态为"草稿" (draft)
- **编辑活动**：保持原有状态不变
- **草稿活动**：不会在分类统计中显示

### 3. 状态筛选优化

在列表顶部添加了状态下拉筛选框，支持按以下状态筛选：

```
全部状态 | 草稿 | 待开始 | 进行中 | 已过期
```

## 🎨 界面展示

### 状态徽章样式

```
草稿     [灰色背景]
待开始   [橙色背景]
进行中   [绿色背景]
已过期   [红色背景]
```

### 按钮样式

- **保存为草稿按钮**：灰色背景 (#9E9E9E)
- **保存按钮**：绿色背景 (渐变)
- **取消按钮**：浅灰色背景

## 📝 使用流程

### 创建新活动流程

1. 点击"新增活动"按钮
2. 填写活动信息（标题、描述、分类等）
3. 选择活动状态：
   - 保持默认"草稿"，点击"📝 保存为草稿"
   - 或选择其他状态，点击"💾 保存"
4. 系统提示保存成功

### 管理活动流程

1. 使用筛选器快速找到需要管理的活动
2. 点击"编辑"按钮修改活动信息
3. 根据需要：
   - 更新状态（如：待开始 → 进行中）
   - 修改其他信息
4. 保存更改

## 🔧 技术实现

### 前端修改 (admin.html)

1. **CSS 样式**
   - 新增 4 个状态样式类
   - 新增草稿按钮样式

2. **HTML 结构**
   - 更新状态下拉框选项（4 个状态）
   - 更新筛选下拉框选项（5 个选项含"全部"）
   - 新增"保存为草稿"按钮

3. **JavaScript 逻辑**
   - `getStatusText()` 函数：状态码转中文
   - `submitFormAsDraft()` 函数：保存为草稿
   - 表单默认状态设置
   - 图片列表清空逻辑
   - 成功消息优化

### 后端修改 (server.js)

1. **API 优化**
   - 分类统计接口：只统计非草稿活动
   - 支持新的状态值过滤

2. **兼容性**
   - 完全向后兼容 `active` 状态
   - 无需修改现有数据

## 📊 数据迁移

### 现有数据处理

| 原状态 | 迁移后状态 | 说明 |
|--------|-----------|------|
| active | ongoing | 建议：手动更新为对应状态 |
| expired | expired | 保持不变 |
| draft | draft | 保持不变 |

**迁移建议**：
- 草稿和已过期活动无需处理
- 原"活跃"活动需要根据实际情况更新为：
  - 待开始 (pending)
  - 进行中 (ongoing)

## ✅ 测试清单

### 功能测试

- [x] 新增活动默认状态为"草稿"
- [x] "保存为草稿"按钮正常工作
- [x] 状态下拉框显示 4 个选项
- [x] 状态筛选功能正常
- [x] 状态徽章颜色正确显示
- [x] 编辑活动保持原状态
- [x] 保存成功提示消息正确

### API 测试

```bash
# 获取所有活动（包含草稿）
curl http://localhost:3000/api/activities

# 筛选草稿活动
curl http://localhost:3000/api/activities?status=draft

# 筛选待开始活动
curl http://localhost:3000/api/activities?status=pending

# 分类统计（排除草稿）
curl http://localhost:3000/api/activities/stats/categories
```

## 🎯 后续优化建议

1. **批量更新状态**
   - 添加批量操作功能
   - 支持一键将多个草稿发布

2. **自动状态更新**
   - 根据日期自动更新状态
   - 待开始 → 进行中 → 已过期

3. **状态权限控制**
   - 草稿：仅创建者可编辑
   - 已发布：管理员可编辑

4. **状态变更记录**
   - 记录状态变更历史
   - 显示操作人和时间

## 📞 技术支持

如有问题，请访问：
- 后台管理：http://localhost:3000/admin.html
- API 文档：http://localhost:3000/api
- 前端展示：http://localhost:5173/

---

**更新时间**：2025-01-24
**版本**：v2.1.0
**作者**：Claude Code
