# æ—¶é—´æ’åºä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2026-01-29
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•é¡µé¢**: http://localhost:3000/test-time-sorting.html

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. æ·»åŠ æ—¶é—´æ’åºå·¥å…·å‡½æ•°

**ä½ç½®**: `public/index.html` ç¬¬2519-2585è¡Œ

**æ·»åŠ çš„å‡½æ•°**:
```javascript
/**
 * æå–æ—¶é—´çš„å¼€å§‹éƒ¨åˆ†
 * @param {string} timeStr - æ—¶é—´å­—ç¬¦ä¸²ï¼Œå¦‚ "16:00-19:00"
 * @returns {object} - { hour, minute, original }
 */
function extractStartTime(timeStr) {
    if (!timeStr || timeStr === 'çµæ´»æ—¶é—´') {
        return { hour: 99, minute: 99, original: timeStr || 'çµæ´»æ—¶é—´' };
    }

    const match = timeStr.match(/^(\d{1,2}):(\d{2})/);
    if (match) {
        return {
            hour: parseInt(match[1], 10),
            minute: parseInt(match[2], 10),
            original: timeStr
        };
    }

    return { hour: 99, minute: 99, original: timeStr };
}

/**
 * æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´å­—ç¬¦ä¸²
 * @param {string} timeA - æ—¶é—´A
 * @param {string} timeB - æ—¶é—´B
 * @returns {number} - -1 (Aåœ¨å‰), 0 (ç›¸åŒ), 1 (Båœ¨å‰)
 */
function compareTimes(timeA, timeB) {
    const extractedA = extractStartTime(timeA);
    const extractedB = extractStartTime(timeB);

    // æŒ‰å¼€å§‹æ—¶é—´çš„æ•°å­—å€¼æ¯”è¾ƒ
    if (extractedA.hour !== extractedB.hour) {
        return extractedA.hour - extractedB.hour;
    }

    if (extractedA.minute !== extractedB.minute) {
        return extractedA.minute - extractedB.minute;
    }

    // å¦‚æœå¼€å§‹æ—¶é—´ç›¸åŒï¼Œå•ä¸€æ—¶é—´ç‚¹æ’åœ¨æ—¶é—´æ®µå‰é¢
    const isRangeA = extractedA.original.includes('-');
    const isRangeB = extractedB.original.includes('-');

    if (isRangeA && !isRangeB) return 1;   // Aæ˜¯èŒƒå›´ï¼ŒBæ˜¯ç‚¹ â†’ Båœ¨å‰
    if (!isRangeA && isRangeB) return -1;  // Aæ˜¯ç‚¹ï¼ŒBæ˜¯èŒƒå›´ â†’ Aåœ¨å‰

    return 0; // ä¿æŒåŸé¡ºåº
}
```

### 2. ä¿®å¤ç¬¬ä¸€å¤„æ’åºï¼šcreateDayViewå‡½æ•°

**ä½ç½®**: `public/index.html` ç¬¬3448-3453è¡Œ

**ä¿®æ”¹å‰**:
```javascript
// æŒ‰æ—¶é—´æ’åºï¼ˆè¾ƒæ—©çš„æ´»åŠ¨æ’åœ¨å‰é¢ï¼‰
activitiesToShow = activitiesToShow.sort((a, b) => {
    const timeA = a.time || a.startTime || '99:99';
    const timeB = b.time || b.startTime || '99:99';
    return timeA.localeCompare(timeB);  // âŒ å­—ç¬¦ä¸²æ¯”è¾ƒ
});
```

**ä¿®æ”¹å**:
```javascript
// æŒ‰æ—¶é—´æ’åºï¼ˆè¾ƒæ—©çš„æ´»åŠ¨æ’åœ¨å‰é¢ï¼‰- ä½¿ç”¨æ•°å­—æ¯”è¾ƒ
activitiesToShow = activitiesToShow.sort((a, b) => {
    const timeA = a.time || a.startTime || 'çµæ´»æ—¶é—´';
    const timeB = b.time || b.startTime || 'çµæ´»æ—¶é—´';
    return compareTimes(timeA, timeB);  // âœ… æ•°å­—æ¯”è¾ƒ
});
```

### 3. ä¿®å¤ç¬¬äºŒå¤„æ’åºï¼šupdateListViewå‡½æ•°

**ä½ç½®**: `public/index.html` ç¬¬3492-3506è¡Œ

**ä¿®æ”¹å‰**:
```javascript
// æŒ‰æ—¶é—´æ’åºï¼šæ—©çš„æ—¶é—´æ’åœ¨å‰é¢
const sortedFiltered = [...filtered].sort((a, b) => {
    // æå–å¼€å§‹æ—¶é—´ï¼ˆä¾‹å¦‚ï¼šä»"08:30-09:45"æå–"08:30"ï¼‰
    const extractStartTime = (timeStr) => {
        if (!timeStr || timeStr === 'çµæ´»æ—¶é—´') return '99:99';
        const match = timeStr.match(/^(\d{1,2}):(\d{2})/);
        return match ? match[0] : '99:99';
    };

    const timeA = extractStartTime(a.time);
    const timeB = extractStartTime(b.time);

    // æŒ‰å¼€å§‹æ—¶é—´å‡åºæ’åˆ—
    return timeA.localeCompare(timeB);  // âŒ å­—ç¬¦ä¸²æ¯”è¾ƒ
});
```

**ä¿®æ”¹å**:
```javascript
// æŒ‰æ—¶é—´æ’åºï¼šæ—©çš„æ—¶é—´æ’åœ¨å‰é¢ - ä½¿ç”¨æ•°å­—æ¯”è¾ƒ
const sortedFiltered = [...filtered].sort((a, b) => {
    return compareTimes(a.time, b.time);  // âœ… æ•°å­—æ¯”è¾ƒ
});
```

---

## ğŸ¯ ä¿®å¤æ•ˆæœå¯¹æ¯”

### åœºæ™¯1: 16:00-19:00æ—¶é—´æ®µæ’åº

**è¾“å…¥æ•°æ®**:
```javascript
[
  { title: "æ´»åŠ¨A", time: "19:00" },
  { title: "æ´»åŠ¨B", time: "16:00" },
  { title: "æ´»åŠ¨C", time: "16:00-19:00" }
]
```

**ä¿®æ”¹å‰ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒï¼‰**:
```
1. 16:00-19:00æ´»åŠ¨  â† "16:00-" < "16:00"
2. 16:00æ´»åŠ¨
3. 19:00æ´»åŠ¨
```

**ä¿®æ”¹åï¼ˆæ•°å­—æ¯”è¾ƒï¼‰**:
```
1. 16:00æ´»åŠ¨         âœ… 16:00 (ç‚¹)
2. 16:00-19:00æ´»åŠ¨    âœ… 16:00 (èŒƒå›´)
3. 19:00æ´»åŠ¨         âœ… 19:00
```

### åœºæ™¯2: 9:00 vs 10:00ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒbugï¼‰

**è¾“å…¥æ•°æ®**:
```javascript
[
  { title: "10:00æ´»åŠ¨", time: "10:00" },
  { title: "9:00æ´»åŠ¨", time: "9:00" }
]
```

**ä¿®æ”¹å‰ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒï¼‰**:
```
1. 10:00æ´»åŠ¨  âŒ "1" < "9"
2. 9:00æ´»åŠ¨
```

**ä¿®æ”¹åï¼ˆæ•°å­—æ¯”è¾ƒï¼‰**:
```
1. 9:00æ´»åŠ¨   âœ… 9 < 10
2. 10:00æ´»åŠ¨
```

---

## ğŸ“Š æ’åºè§„åˆ™æ€»ç»“

### å®Œæ•´çš„æ’åºé€»è¾‘

```
ä¼˜å…ˆçº§1: æŒ‰å¼€å§‹æ—¶é—´çš„å°æ—¶æ•°ï¼ˆæ•°å­—ï¼‰
  9:00 < 10:00 < 16:00 < 19:00

ä¼˜å…ˆçº§2: ç›¸åŒå°æ—¶ï¼ŒæŒ‰åˆ†é’Ÿæ•°ï¼ˆæ•°å­—ï¼‰
  16:00 < 16:30 < 16:45

ä¼˜å…ˆçº§3: ç›¸åŒå¼€å§‹æ—¶é—´
  - å•ä¸€æ—¶é—´ç‚¹ï¼ˆå¦‚ 16:00ï¼‰æ’åœ¨å‰é¢
  - æ—¶é—´æ®µï¼ˆå¦‚ 16:00-19:00ï¼‰æ’åœ¨åé¢
  - ä¿æŒåŸæœ‰ç›¸å¯¹é¡ºåº

ä¼˜å…ˆçº§4: çµæ´»æ—¶é—´
  - çµæ´»æ—¶é—´æ’åœ¨æœ€åï¼ˆhour=99, minute=99ï¼‰
```

### å¤„ç†çš„æ—¶é—´æ ¼å¼

| æ ¼å¼ | ç¤ºä¾‹ | æå–ç»“æœ | æ’åºä¾æ® |
|------|------|----------|----------|
| å•ä¸€æ—¶é—´ç‚¹ | `16:00` | `{hour:16, minute:0}` | 16:00 |
| æ—¶é—´æ®µ | `16:00-19:00` | `{hour:16, minute:0}` | 16:00 |
| è·¨æ—¥æ—¶æ®µ | `16:00-00:00` | `{hour:16, minute:0}` | 16:00 |
| å¤šæ—¶æ®µ | `09:30-10:30, 18:30-19:30` | `{hour:9, minute:30}` | 09:30 |
| å…¨å¤© | `00:00-24:00` | `{hour:0, minute:0}` | 00:00 |
| çµæ´»æ—¶é—´ | `çµæ´»æ—¶é—´` | `{hour:99, minute:99}` | æœ€å |

---

## âœ… ä¸‰Tabä¸€è‡´æ€§ç¡®è®¤

### éªŒè¯ç»“æœ

**ä¸‰ä¸ªTabä½¿ç”¨çš„æ’åºå‡½æ•°**:
- âœ… å…´è¶£ç­ Tab: `createDayView` â†’ ä½¿ç”¨ `compareTimes()`
- âœ… å¸‚é›† Tab: `createDayView` â†’ ä½¿ç”¨ `compareTimes()`
- âœ… éŸ³ä¹ Tab: `createDayView` â†’ ä½¿ç”¨ `compareTimes()`

**åˆ—è¡¨è§†å›¾æ’åº**:
- âœ… çµæ´»æ—¶é—´æ´»åŠ¨ Tab: `updateListView` â†’ ä½¿ç”¨ `compareTimes()`

**ç»“è®º**: âœ… **ä¸‰ä¸ªTabä½¿ç”¨ç›¸åŒçš„æ’åºé€»è¾‘ï¼Œå·²ä¿æŒä¸€è‡´**

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•é¡µé¢

**è®¿é—®åœ°å€**: http://localhost:3000/test-time-sorting.html

**æµ‹è¯•ç”¨ä¾‹**:
1. âœ… æµ‹è¯•1: åŸºæœ¬æ’åºï¼ˆ16:00-19:00åœºæ™¯ï¼‰
2. âœ… æµ‹è¯•2: 9:00 vs 10:00ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒé—®é¢˜ï¼‰
3. âœ… æµ‹è¯•3: ç›¸åŒå¼€å§‹æ—¶é—´ï¼ˆç‚¹ vs èŒƒå›´ï¼‰
4. âœ… æµ‹è¯•4: çµæ´»æ—¶é—´æ’åº
5. âœ… æµ‹è¯•5: çœŸå®æ•°æ®æµ‹è¯•

### é¢„æœŸæµ‹è¯•ç»“æœ

```
æµ‹è¯•1: âœ… é€šè¿‡
  è¾“å…¥: 19:00, 16:00, 16:00-19:00
  è¾“å‡º: 16:00, 16:00-19:00, 19:00

æµ‹è¯•2: âœ… é€šè¿‡
  è¾“å…¥: 10:00, 9:00
  è¾“å‡º: 9:00, 10:00

æµ‹è¯•3: âœ… é€šè¿‡
  è¾“å…¥: 16:00, 16:00-19:00
  éªŒè¯: ç¬¬ä¸€ä¸ªæ˜¯å•ä¸€æ—¶é—´ç‚¹16:00

æµ‹è¯•4: âœ… é€šè¿‡
  è¾“å…¥: çµæ´»æ—¶é—´, 16:00
  éªŒè¯: çµæ´»æ—¶é—´åœ¨æœ€å

æµ‹è¯•5: âœ… é€šè¿‡
  çœŸå®æ•°æ®: APIè¿”å›çš„æ´»åŠ¨
  æ’åº: æŒ‰æ—¶é—´æ­£ç¡®æ’åº
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ–‡ä»¶: `public/index.html`

**ä¿®æ”¹å†…å®¹**:
1. âœ… ç¬¬2519-2585è¡Œ: æ·»åŠ  `extractStartTime()` å’Œ `compareTimes()` å‡½æ•°
2. âœ… ç¬¬3448-3453è¡Œ: ä¿®å¤ `createDayView` å‡½æ•°çš„æ’åº
3. âœ… ç¬¬3492-3506è¡Œ: ä¿®å¤ `updateListView` å‡½æ•°çš„æ’åº

**ä¿®æ”¹è¡Œæ•°**: çº¦60è¡Œ

### æ–‡ä»¶: `public/test-time-sorting.html` (æ–°å»º)

**ç”¨é€”**: éªŒè¯æ—¶é—´æ’åºä¿®å¤æ•ˆæœ

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### ä¸ºä»€ä¹ˆè¦æ•°å­—æ¯”è¾ƒè€Œéå­—ç¬¦ä¸²æ¯”è¾ƒï¼Ÿ

**é—®é¢˜**: å­—ç¬¦ä¸²æ¯”è¾ƒæŒ‰å­—å…¸åº
```javascript
"9:00"  // "9" > "1"
"10:00" // "10" > "1"

// å­—ç¬¦ä¸²æ¯”è¾ƒ: "10:00" < "9:00" âŒ
// å› ä¸º '1' < '9'
```

**è§£å†³**: æ•°å­—æ¯”è¾ƒæŒ‰æ•°å€¼
```javascript
// 9:00  â†’ 9
// 10:00 â†’ 10

// æ•°å­—æ¯”è¾ƒ: 9 < 10 âœ…
```

### ç›¸åŒå¼€å§‹æ—¶é—´å¦‚ä½•æ’åºï¼Ÿ

**è§„åˆ™**: å•ä¸€ç‚¹æ’åœ¨èŒƒå›´å‰é¢

**åŸå› **:
- å•ä¸€æ—¶é—´ç‚¹ï¼ˆå¦‚16:00ï¼‰æ˜¯"å‡†æ—¶"æ´»åŠ¨
- æ—¶é—´æ®µï¼ˆå¦‚16:00-19:00ï¼‰æ˜¯"æŒç»­"æ´»åŠ¨
- ç”¨æˆ·æ›´å…³æ³¨å‡†æ—¶å¼€å§‹çš„æ´»åŠ¨

**å®ç°**:
```javascript
if (extractedA.hour === extractedB.hour &&
    extractedA.minute === extractedB.minute) {
    // å¼€å§‹æ—¶é—´ç›¸åŒ
    const isRangeA = timeA.includes('-');
    const isRangeB = timeB.includes('-');

    if (isRangeA && !isRangeB) return 1;   // AèŒƒå›´ï¼ŒBç‚¹ â†’ Båœ¨å‰
    if (!isRangeA && isRangeB) return -1;  // Aç‚¹ï¼ŒBèŒƒå›´ â†’ Aåœ¨å‰
}
```

---

## âœ… ä¿®å¤ç¡®è®¤

- âœ… æ·»åŠ æ—¶é—´æ¯”è¾ƒå‡½æ•°
- âœ… ä¿®å¤createDayViewæ’åº
- âœ… ä¿®å¤updateListViewæ’åº
- âœ… åˆ›å»ºæµ‹è¯•é¡µé¢
- âœ… ä¸‰Tabä½¿ç”¨ç›¸åŒæ’åºé€»è¾‘
- âœ… å¤„ç†æ‰€æœ‰æ—¶é—´æ ¼å¼
- âœ… æ•°å­—æ¯”è¾ƒä»£æ›¿å­—ç¬¦ä¸²æ¯”è¾ƒ

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-01-29
**æµ‹è¯•çŠ¶æ€**: âœ… å¾…éªŒè¯
**æ–‡æ¡£**: [SORTING-RULES-ANALYSIS.md](SORTING-RULES-ANALYSIS.md)

---

**ä¸‹ä¸€æ­¥**: è®¿é—® http://localhost:3000/test-time-sorting.html æŸ¥çœ‹æµ‹è¯•ç»“æœ
