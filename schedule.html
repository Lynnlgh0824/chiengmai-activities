<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…è¿ˆå‘¨è¯¾è¡¨ - å…´è¶£è¯¾ç¨‹æ±‡æ€»</title>
  <link rel="stylesheet" href="/src/components/WeeklyCalendarView.css">
  <link rel="stylesheet" href="/src/components/ScheduleListView.css">
  <link rel="stylesheet" href="/src/pages/Schedule.css">
</head>
<body>
  <div class="schedule-page">
    <div class="schedule-header">
      <div class="header-content">
        <div class="header-title">
          <h1>ğŸ—“ï¸ æ¸…è¿ˆå‘¨è¯¾è¡¨</h1>
          <p>å‘ç°æœ¬å‘¨å…è´¹å…´è¶£è¯¾ç¨‹å’Œæ´»åŠ¨</p>
        </div>
        <a href="/" class="back-button">
          <span>â†</span>
          <span>è¿”å›æ´»åŠ¨åˆ—è¡¨</span>
        </a>
      </div>

      <div class="view-toggle">
        <button class="view-button active" id="calendarViewBtn" onclick="switchView('calendar')">
          <span>ğŸ“…</span>
          <span>æ—¥å†è§†å›¾</span>
        </button>
        <button class="view-button" id="listViewBtn" onclick="switchView('list')">
          <span>ğŸ“‹</span>
          <span>åˆ—è¡¨è§†å›¾</span>
        </button>
      </div>
    </div>

    <div class="schedule-content" id="scheduleContent">
      <!-- å†…å®¹å°†ç”± JavaScript åŠ¨æ€åŠ è½½ -->
    </div>
  </div>

  <script type="module" src="/src/data/weeklySchedule.js"></script>
  <script type="module">
    import { weeklyScheduleData, dayNames } from './src/data/weeklySchedule.js'

    let currentView = 'calendar'

    // æ¸²æŸ“æ—¥å†è§†å›¾
    function renderCalendarView() {
      const container = document.getElementById('scheduleContent')
      const html = weeklyScheduleData.map((week, weekIndex) => `
        <div class="week-card">
          <div class="week-header">
            <h3 class="week-title">${week.week}</h3>
            <span class="week-date-range">${week.startDate} ~ ${week.endDate}</span>
          </div>
          <div class="calendar-grid">
            ${dayNames.map(day => `<div class="calendar-day-header">${day}</div>`).join('')}
            ${[1, 2, 3, 4, 5, 6, 0].map(dayIndex => {
              const dayActivities = week.activities.filter(a => a.dayOfWeek === dayIndex)
              return `
                <div class="calendar-day ${dayActivities.length > 0 ? 'has-activity' : ''}">
                  <div class="day-number">${getDisplayDate(week, dayIndex)}</div>
                  <div class="day-activities">
                    ${dayActivities.map(activity => `
                      <div class="activity-card-mini" style="border-left-color: ${getCategoryColor(activity.category)}">
                        <div class="activity-time">${activity.time}</div>
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-location">ğŸ“ ${activity.location}</div>
                        <div class="activity-price">${activity.price}</div>
                        ${activity.enrolled && activity.capacity ? `
                          <div class="activity-enrollment">${activity.enrolled}/${activity.capacity}</div>
                        ` : ''}
                      </div>
                    `).join('')}
                  </div>
                </div>
              `
            }).join('')}
          </div>
        </div>
      `).join('')

      container.innerHTML = html
    }

    // æ¸²æŸ“åˆ—è¡¨è§†å›¾
    function renderListView() {
      const container = document.getElementById('scheduleContent')
      const allActivities = weeklyScheduleData.flatMap(week => week.activities)

      const html = `
        <div class="schedule-list">
          ${allActivities.map(activity => `
            <div class="schedule-item">
              <div class="date-badge">
                <div class="date-day">${dayNames[new Date('2025-01-01').getDay()]}</div>
                <div class="date-number">${new Date('2025-01-01').getDate()}</div>
              </div>
              <div class="activity-content">
                <div class="activity-header">
                  <span class="category-tag" style="background-color: ${getCategoryColor(activity.category)}">
                    ${activity.category}
                  </span>
                  ${activity.price ? `<span class="price-badge">${activity.price}</span>` : ''}
                </div>
                <h3 class="activity-title">${activity.title}</h3>
                <p class="activity-description">${activity.description}</p>
                <div class="activity-meta">
                  <div class="meta-item"><span>â°</span><span>${activity.time}</span></div>
                  <div class="meta-item"><span>ğŸ“</span><span>${activity.location}</span></div>
                  ${activity.teacher ? `<div class="meta-item"><span>ğŸ‘¨â€ğŸ«</span><span>${activity.teacher}</span></div>` : ''}
                </div>
                ${activity.enrolled && activity.capacity ? `
                  <div class="enrollment-bar">
                    <div class="enrollment-progress">
                      <div class="enrollment-fill" style="width: ${(activity.enrolled / activity.capacity) * 100}%; background-color: ${getCategoryColor(activity.category)}"></div>
                    </div>
                    <span class="enrollment-text">å·²æŠ¥å ${activity.enrolled}/${activity.capacity}</span>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
        </div>
      `

      container.innerHTML = html
    }

    // åˆ‡æ¢è§†å›¾
    window.switchView = function(view) {
      currentView = view
      document.getElementById('calendarViewBtn').classList.toggle('active', view === 'calendar')
      document.getElementById('listViewBtn').classList.toggle('active', view === 'list')

      if (view === 'calendar') {
        renderCalendarView()
      } else {
        renderListView()
      }
    }

    function getDisplayDate(week, dayIndex) {
      const startDate = new Date(week.startDate)
      const targetDate = new Date(startDate)
      targetDate.setDate(startDate.getDate() + dayIndex)
      return targetDate.getDate()
    }

    function getCategoryColor(category) {
      const colors = {
        'ç‘œä¼½': '#FF6B6B',
        'å†¥æƒ³': '#4ECDC4',
        'æˆ·å¤–æ¢é™©': '#FFE66D',
        'æ–‡åŒ–è‰ºæœ¯': '#95E1D3',
        'ç¾é£Ÿä½“éªŒ': '#F38181',
        'å…¶ä»–': '#667eea'
      }
      return colors[category] || '#667eea'
    }

    // åˆå§‹åŒ–
    renderCalendarView()
  </script>
</body>
</html>
