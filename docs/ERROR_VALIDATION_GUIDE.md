# Excel 导入验证错误提示指南

## 概述

Excel 导入脚本提供了完善的数据验证和错误提示功能，确保只有符合规范的数据才能导入到系统中。

## 错误提示功能

### 1. 实时控制台输出

导入过程中，所有错误都会实时显示在控制台：

```
⚠️  发现 6 个验证错误:

   1. 第1行 "未命名活动":
      ❌ 字段: 活动标题
      📝 错误: 活动标题不能为空
      💡 建议: 此字段为必填项，请填写内容

   2. 第2行 "测试活动2":
      ❌ 字段: 分类
      📝 错误: 分类不能为空
      💡 建议: 此字段为必填项，请填写内容
   ...
```

### 2. JSON 格式错误报告

详细错误信息保存在 `logs/import-error-{timestamp}.json`：

```json
{
  "timestamp": "2026-01-26T16:44:22.916Z",
  "filename": "清迈活动数据.xlsx",
  "summary": {
    "total": 47,
    "failed": 6,
    "success": 41,
    "errorCount": 6
  },
  "errors": [
    {
      "row": 1,
      "title": "未命名活动",
      "field": "活动标题",
      "error": "活动标题不能为空",
      "suggestion": "此字段为必填项，请填写内容"
    }
  ]
}
```

### 3. Markdown 格式错误报告

易读的错误报告保存在 `logs/import-error-{timestamp}.md`：

```markdown
# Excel 导入错误报告

**文件名**: 清迈活动数据.xlsx
**时间**: 2026/1/27 00:44:22

## 📊 错误统计

- **总记录数**: 47
- **验证通过**: 41
- **验证失败**: 6
- **错误总数**: 6

## ❌ 详细错误列表

### 1. 第 1 行 - 未命名活动

- **字段**: 活动标题
- **错误**: 活动标题不能为空
- **建议**: 此字段为必填项，请填写内容
...
```

## 验证规则

### 必填字段

以下字段不能为空：
- 活动标题 (title)
- 分类 (category)
- 地点 (location)
- 时间 (time)

### 格式验证

#### 时间格式
- ✅ 正确：`09:00-10:00`、`09:30-10:30, 18:30-19:30`
- ✅ 特殊值：`灵活时间`、`待定`、`TBD`、`全天`
- ❌ 错误：`invalid-time`、`早上`、`9点`

#### 星期格式
- ✅ 正确：`周一`、`周二、周四`、`周一、周三、周五`
- ✅ 特殊值：`灵活时间`、`待定`、`TBD`、`无固定时间`、`-`、`每天`
- ❌ 错误：`Mon`、`星期一`、`错误的星期`

#### 价格格式
- ✅ 正确：`免费`、`100฿`、`100-500฿`、`捐赠`
- ✅ 包含数字：`50泰铢`、`walkin`
- ❌ 错误：空字符串

### 唯一性验证

- **活动编号**：不能重复（会自动生成缺失的编号）
- **活动标题**：不能重复

## 错误处理流程

1. **检测错误**：导入时自动验证所有数据
2. **显示错误**：在控制台显示所有错误详情
3. **保存报告**：生成 JSON 和 Markdown 格式的错误报告
4. **中止导入**：阻止错误数据进入系统
5. **修正数据**：根据错误提示在 Excel 中修正数据
6. **重新导入**：修正后再次运行 `npm run import-excel`

## 测试错误提示

运行测试脚本查看错误提示效果：

```bash
node scripts/test-error-validation.mjs
```

## 相关文件

- 导入脚本：`scripts/import-excel-enhanced.mjs`
- 验证器：`scripts/validators.mjs`
- 测试脚本：`scripts/test-error-validation.mjs`
- 错误日志：`logs/import-error-*.json` 和 `logs/import-error-*.md`

## 常见错误及解决方法

### 1. 活动标题为空
**错误**：`活动标题不能为空`
**解决**：在 Excel 的"活动标题"列填写内容

### 2. 分类为空
**错误**：`分类不能为空`
**解决**：在 Excel 的"分类"列填写内容（如：市集、运动、冥想等）

### 3. 时间格式错误
**错误**：`时间格式错误`
**解决**：使用 `HH:MM-HH:MM` 格式，如 `09:00-10:00`

### 4. 星期格式错误
**错误**：`星期格式错误：xxx`
**解决**：使用"周一、周二"等格式，或"灵活时间"、"无固定时间"

### 5. 活动编号重复
**错误**：`活动编号 "xxx" 在当前导入批次中重复`
**解决**：确保每个活动的编号唯一，或清空编号自动生成

### 6. 活动标题重复
**错误**：`活动标题 "xxx" 已存在于数据库中`
**解决**：使用不同的活动标题，或确认是否要更新现有活动
