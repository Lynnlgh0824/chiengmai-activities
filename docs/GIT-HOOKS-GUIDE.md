# Git Hooks ä½¿ç”¨æŒ‡å—

> è‡ªåŠ¨åŒ– Git å·¥ä½œæµç¨‹å’Œå®‰å…¨æ£€æŸ¥
>
> æ›´æ–°æ—¶é—´ï¼š2026-01-29

## ğŸ“‹ ç›®å½•

- [ä»€ä¹ˆæ˜¯ Git Hooks](#ä»€ä¹ˆæ˜¯-git-hooks)
- [å·²é…ç½®çš„ Hooks](#å·²é…ç½®çš„-hooks)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [Hooks ç®¡ç†è„šæœ¬](#hooks-ç®¡ç†è„šæœ¬)
- [è‡ªå®šä¹‰ Hooks](#è‡ªå®šä¹‰-hooks)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ä»€ä¹ˆæ˜¯ Git Hooks

Git Hooks æ˜¯åœ¨ Git æ‰§è¡Œç‰¹å®šäº‹ä»¶ï¼ˆå¦‚æäº¤ã€æ¨é€ï¼‰æ—¶è‡ªåŠ¨è§¦å‘çš„è„šæœ¬ã€‚å®ƒä»¬ç”¨äºï¼š

- âœ… è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥
- âœ… é˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²
- âœ… å¼ºåˆ¶æ‰§è¡Œä»£ç è§„èŒƒ
- âœ… è‡ªåŠ¨è¿è¡Œæµ‹è¯•

### Hook ç±»å‹

| Hook | è§¦å‘æ—¶æœº | ç”¨é€” |
|------|----------|------|
| `pre-commit` | æ‰§è¡Œ `git commit` åï¼Œè¾“å…¥æäº¤ä¿¡æ¯å‰ | æ£€æŸ¥æš‚å­˜åŒºå†…å®¹ |
| `commit-msg` | æäº¤ä¿¡æ¯å®Œæˆå | éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼ |
| `pre-push` | æ‰§è¡Œ `git push` åï¼Œæ¨é€å‰ | è¿è¡Œæµ‹è¯•ã€æ£€æŸ¥ä»£ç  |

---

## å·²é…ç½®çš„ Hooks

### 1. Pre-Commit Hook

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡è¿è¡Œ `git commit` æ—¶

**åŠŸèƒ½**ï¼š
- âœ… æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦è¢«æäº¤
- âœ… æ‰«æç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€API å¯†é’¥ç­‰ï¼‰
- âœ… æ£€æŸ¥ç§æœ‰ç›®å½•ï¼ˆinternal-notes/ã€daily-logs/ï¼‰
- âœ… è­¦å‘Šå¤§æ–‡ä»¶ï¼ˆ>1MBï¼‰

**æ£€æŸ¥ç»“æœç¤ºä¾‹**ï¼š
```
======================================
Git å®‰å…¨æ£€æŸ¥
======================================

æ£€æŸ¥1: .env æ–‡ä»¶
âœ… é€šè¿‡: .env æ–‡ä»¶æœªè¢«æäº¤

æ£€æŸ¥2: æ•æ„Ÿä¿¡æ¯æ¨¡å¼
âœ… é€šè¿‡: æœªæ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯

æ£€æŸ¥3: ç§æœ‰ç›®å½•
âœ… é€šè¿‡: ç§æœ‰ç›®å½•æ£€æŸ¥å®Œæˆ

æ£€æŸ¥4: å¤§æ–‡ä»¶æ£€æŸ¥
âœ… é€šè¿‡: æ— å¤§æ–‡ä»¶

======================================
âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼
======================================
```

### 2. Commit-Message Hookï¼ˆå¯é€‰ï¼‰

**è§¦å‘æ—¶æœº**ï¼šæäº¤ä¿¡æ¯å®Œæˆå

**åŠŸèƒ½**ï¼š
- âœ… éªŒè¯æäº¤ä¿¡æ¯éç©º
- âœ… å»ºè®®æäº¤ä¿¡æ¯è‡³å°‘ 10 ä¸ªå­—ç¬¦

---

## ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨è¿è¡Œ

Pre-commit hook ä¼šåœ¨æ¯æ¬¡ `git commit` æ—¶**è‡ªåŠ¨è¿è¡Œ**ï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘ã€‚

```bash
# æ­£å¸¸æäº¤å³å¯ï¼Œhook ä¼šè‡ªåŠ¨è¿è¡Œ
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# Hook è‡ªåŠ¨è¿è¡Œå®‰å…¨æ£€æŸ¥
# âœ… é€šè¿‡ â†’ æäº¤æˆåŠŸ
# âŒ å¤±è´¥ â†’ æäº¤è¢«é˜»æ­¢ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

### è·³è¿‡ Hookï¼ˆä¸æ¨èï¼‰

å¦‚æœéœ€è¦è·³è¿‡æ£€æŸ¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š

```bash
# ä½¿ç”¨ --no-verify è·³è¿‡ hook
git commit --no-verify -m "message"

# âš ï¸ è­¦å‘Šï¼šè·³è¿‡å®‰å…¨æ£€æŸ¥å¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²
```

---

## Hooks ç®¡ç†è„šæœ¬

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„ hooks ç®¡ç†è„šæœ¬ï¼š`scripts/manage-hooks.sh`

### æŸ¥çœ‹å¸®åŠ©

```bash
./scripts/manage-hooks.sh help
```

### æŸ¥çœ‹çŠ¶æ€

```bash
./scripts/manage-hooks.sh status
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“Š Git Hooks çŠ¶æ€

âœ… pre-commit - å·²å®‰è£…å¹¶å¯æ‰§è¡Œ
âŒ commit-msg - æœªå®‰è£…
âŒ pre-push - æœªå®‰è£…

Hook ç›®å½•ï¼š/Users/.../project/.git/hooks
```

### å®‰è£… Hooks

```bash
./scripts/manage-hooks.sh install
```

è¿™ä¼šå®‰è£…ï¼š
- `pre-commit` - å®‰å…¨æ£€æŸ¥
- `commit-msg` - æäº¤ä¿¡æ¯éªŒè¯

### å¸è½½ Hooks

```bash
./scripts/manage-hooks.sh uninstall
```

### æµ‹è¯• Hook

```bash
./scripts/manage-hooks.sh test
```

---

## å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ 1ï¼šæ­£å¸¸æäº¤

```bash
# 1. ä¿®æ”¹æ–‡ä»¶
echo "console.log('test');" > test.js

# 2. æ·»åŠ åˆ°æš‚å­˜åŒº
git add test.js

# 3. æäº¤ï¼ˆhook è‡ªåŠ¨è¿è¡Œï¼‰
git commit -m "feat: æ·»åŠ æµ‹è¯•æ–‡ä»¶"

# è¾“å‡ºï¼š
# ======================================
# Git å®‰å…¨æ£€æŸ¥
# ======================================
# âœ… é€šè¿‡: .env æ–‡ä»¶æœªè¢«æäº¤
# âœ… é€šè¿‡: æœªæ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯
# âœ… é€šè¿‡: ç§æœ‰ç›®å½•æ£€æŸ¥å®Œæˆ
# âœ… é€šè¿‡: æ— å¤§æ–‡ä»¶
# âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼
# [main abc123] feat: æ·»åŠ æµ‹è¯•æ–‡ä»¶
```

### åœºæ™¯ 2ï¼šæäº¤è¢«é˜»æ­¢

```bash
# 1. æ„å¤–æ·»åŠ  .env æ–‡ä»¶
git add .env

# 2. å°è¯•æäº¤
git commit -m "chore: update config"

# è¾“å‡ºï¼š
# ======================================
# Git å®‰å…¨æ£€æŸ¥
# ======================================
# âŒ é”™è¯¯: .env æ–‡ä»¶å°†è¢«æäº¤ï¼
# è¯·ç«‹å³å–æ¶ˆæäº¤ï¼šgit reset HEAD .env
# âŒ æäº¤è¢«é˜»æ­¢ï¼šå®‰å…¨æ£€æŸ¥æœªé€šè¿‡

# 3. ä¿®å¤é—®é¢˜
git reset HEAD .env

# 4. ç¡®è®¤ .env åœ¨ .gitignore ä¸­
echo ".env" >> .gitignore

# 5. é‡æ–°æäº¤
git add .gitignore
git commit -m "chore: ç¡®ä¿ .env è¢«å¿½ç•¥"
# âœ… æˆåŠŸ
```

### åœºæ™¯ 3ï¼šç¡¬ç¼–ç å¯†ç è¢«æ£€æµ‹

```bash
# 1. åˆ›å»ºåŒ…å«å¯†ç çš„æ–‡ä»¶
echo 'const password = "mySecretPassword123";' > config.js

# 2. å°è¯•æäº¤
git add config.js
git commit -m "feat: æ·»åŠ é…ç½®"

# è¾“å‡ºï¼š
# âŒ è­¦å‘Š: æ£€æµ‹åˆ°å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯
# æ¨¡å¼: password\s*=\s*[\"']?[a-zA-Z0-9]{8,}
# âŒ æäº¤è¢«é˜»æ­¢ï¼šå®‰å…¨æ£€æŸ¥æœªé€šè¿‡

# 3. ä¿®æ”¹ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡
echo 'const password = process.env.DB_PASSWORD;' > config.js
echo "DB_PASSWORD=mySecretPassword123" > .env

# 4. ç¡®è®¤ .env è¢«å¿½ç•¥
git check-ignore -v .env  # åº”æ˜¾ç¤ºè¢«å¿½ç•¥

# 5. é‡æ–°æäº¤
git add config.js
git commit -m "feat: æ·»åŠ é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰"
# âœ… æˆåŠŸ
```

---

## è‡ªå®šä¹‰ Hooks

### æ·»åŠ æ–°çš„æ£€æŸ¥

ç¼–è¾‘ `scripts/git-security-check.sh`ï¼Œæ·»åŠ æ–°çš„æ£€æŸ¥é¡¹ï¼š

```bash
# åœ¨è„šæœ¬æœ«å°¾ã€exit ä¹‹å‰æ·»åŠ 

# æ£€æŸ¥5ï¼šè‡ªå®šä¹‰æ£€æŸ¥
echo -e "${YELLOW}æ£€æŸ¥5: è‡ªå®šä¹‰æ£€æŸ¥${NC}"

# ä½ çš„æ£€æŸ¥é€»è¾‘
if git diff --cached --name-only | grep -q "\.tmp$"; then
    echo -e "${RED}âŒ é”™è¯¯ï¼šä¸å…è®¸æäº¤ .tmp æ–‡ä»¶${NC}"
    exit 1
fi

echo -e "${GREEN}âœ… é€šè¿‡: è‡ªå®šä¹‰æ£€æŸ¥${NC}"
```

### åˆ›å»ºæ–° Hook

1. åˆ›å»º hook è„šæœ¬
2. æ·»åŠ åˆ°ç®¡ç†è„šæœ¬

```bash
# åœ¨ manage-hooks.sh çš„ install_hooks() å‡½æ•°ä¸­æ·»åŠ 

cat > "$HOOKS_DIR/pre-push" << 'EOF'
#!/bin/bash
echo "è¿è¡Œæ¨é€å‰æ£€æŸ¥..."
# ä½ çš„æ£€æŸ¥é€»è¾‘
exit 0
EOF

chmod +x "$HOOKS_DIR/pre-push"
echo -e "${GREEN}âœ… pre-push hook å·²å®‰è£…${NC}"
```

---

## æ•…éšœæ’é™¤

### Hook æ²¡æœ‰è¿è¡Œ

**é—®é¢˜**ï¼šæäº¤æ—¶æ²¡æœ‰çœ‹åˆ°å®‰å…¨æ£€æŸ¥è¾“å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. æ£€æŸ¥ hook æ˜¯å¦å­˜åœ¨
ls -la .git/hooks/pre-commit

# 2. æ£€æŸ¥æ˜¯å¦å¯æ‰§è¡Œ
chmod +x .git/hooks/pre-commit

# 3. é‡æ–°å®‰è£…
./scripts/manage-hooks.sh install
```

### Hook è¿è¡Œä½†æŠ¥é”™

**é—®é¢˜**ï¼šhook æŠ¥é”™æˆ–è¡Œä¸ºå¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. æ‰‹åŠ¨è¿è¡Œå®‰å…¨æ£€æŸ¥è„šæœ¬
./scripts/git-security-check.sh

# 2. æ£€æŸ¥è„šæœ¬è¯­æ³•
bash -n scripts/git-security-check.sh

# 3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
bash -x scripts/git-security-check.sh
```

### æƒ³ä¸´æ—¶ç¦ç”¨ hook

**æ–¹æ³• 1**ï¼šè·³è¿‡ hookï¼ˆä¸æ¨èï¼‰
```bash
git commit --no-verify -m "message"
```

**æ–¹æ³• 2**ï¼šä¸´æ—¶å¸è½½
```bash
./scripts/manage-hooks.sh uninstall
# å®Œæˆå·¥ä½œå
./scripts/manage-hooks.sh install
```

### è°ƒè¯• Hook

```bash
# æŸ¥çœ‹ hook å†…å®¹
cat .git/hooks/pre-commit

# æ‰‹åŠ¨æµ‹è¯•
./scripts/git-security-check.sh

# ä½¿ç”¨ Bash è°ƒè¯•æ¨¡å¼
bash -x .git/hooks/pre-commit
```

---

## æœ€ä½³å®è·µ

### 1. å§‹ç»ˆä¿æŒ Hook å¯ç”¨

```bash
# âœ… å¥½çš„åšæ³•
# æ­£å¸¸æäº¤ï¼Œè®© hook è‡ªåŠ¨æ£€æŸ¥
git commit -m "feat: æ·»åŠ åŠŸèƒ½"

# âŒ é¿å…
# ä¸è¦é¢‘ç¹è·³è¿‡ hook
git commit --no-verify -m "message"
```

### 2. å®šæœŸæ£€æŸ¥ Hook çŠ¶æ€

```bash
# æ¯æœˆæ£€æŸ¥ä¸€æ¬¡
./scripts/manage-hooks.sh status
```

### 3. å›¢é˜Ÿåä½œ

ç¡®ä¿æ‰€æœ‰å›¢é˜Ÿæˆå‘˜éƒ½å®‰è£…äº† hooksï¼š

```bash
# åœ¨ README.md æˆ– onboarding æ–‡æ¡£ä¸­è¯´æ˜
# é¡¹ç›®è®¾ç½®æ­¥éª¤ï¼š

# 1. å…‹éš†ä»“åº“
git clone <repo-url>

# 2. å®‰è£… hooks
cd <project>
./scripts/manage-hooks.sh install
```

### 4. æŒç»­æ”¹è¿›

- å®šæœŸå®¡æŸ¥ hook æ£€æŸ¥é¡¹
- æ ¹æ®å›¢é˜Ÿéœ€æ±‚æ·»åŠ æ–°æ£€æŸ¥
- æ”¶é›†åé¦ˆå¹¶ä¼˜åŒ–

---

## ç›¸å…³èµ„æº

- [Git Hooks å®˜æ–¹æ–‡æ¡£](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)
- [Git å®‰å…¨æŒ‡å—](./GIT-SECURITY-GUIDE.md)
- [Git æœ€ä½³å®è·µ](./GIT-BEST-PRACTICES.md)

---

## å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
./scripts/manage-hooks.sh status

# å®‰è£… hooks
./scripts/manage-hooks.sh install

# å¸è½½ hooks
./scripts/manage-hooks.sh uninstall

# æµ‹è¯• hook
./scripts/manage-hooks.sh test

# æ‰‹åŠ¨è¿è¡Œå®‰å…¨æ£€æŸ¥
./scripts/git-security-check.sh
```

### Hook æ–‡ä»¶ä½ç½®

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .git/
â”‚   â””â”€â”€ hooks/
â”‚       â”œâ”€â”€ pre-commit       # æäº¤å‰æ£€æŸ¥
â”‚       â”œâ”€â”€ commit-msg       # æäº¤ä¿¡æ¯éªŒè¯
â”‚       â””â”€â”€ pre-push         # æ¨é€å‰æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ git-security-check.sh  # å®‰å…¨æ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ manage-hooks.sh         # Hooks ç®¡ç†è„šæœ¬
â””â”€â”€ docs/
    â””â”€â”€ GIT-HOOKS-GUIDE.md      # æœ¬æ–‡æ¡£
```

---

**è®°ä½ï¼šHooks æ˜¯ä½ çš„å®‰å…¨ç½‘ï¼Œè®©å®ƒä»¬ä¿æŒå¯ç”¨çŠ¶æ€ï¼** ğŸ›¡ï¸
