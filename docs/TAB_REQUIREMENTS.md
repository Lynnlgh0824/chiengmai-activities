# 首页5个Tab数据展示需求文档

## 📋 概述

首页包含5个Tab，每个Tab展示不同类型的活动数据，数据之间**完全隔离**，互不影响。

## 🎯 Tab列表

### Tab 0: 📅 兴趣班

**数据筛选条件**：
```javascript
const interestCategories = ['瑜伽', '冥想', '舞蹈', '泰拳', '音乐', '文化艺术', '健身'];
filtered = allActivities.filter(a => interestCategories.includes(a.category));
```

**包含分类**：
- 瑜伽
- 冥想
- 舞蹈
- 泰拳
- 音乐
- 文化艺术
- 健身

**视图类型**：日历视图（周视图）
- 显示周一到周日的网格布局
- 每天显示当天的活动
- 支持周导航（上一周/下一周）

**当前活动数**：23个

---

### Tab 1: 📋 市集

**数据筛选条件**：
```javascript
filtered = allActivities.filter(a => a.category === '市集');
```

**包含分类**：
- 市集（所有类型）

**视图类型**：列表视图
- 按时间排序（早的活动在前）
- 时间提取规则：从 "08:30-09:45" 提取 "08:30"
- 灵活时间排最后（"99:99"）

**列表项包含**：
- 🏷️ 分类标签
- 📅 星期筛选按钮
- 📍 活动标题
- 📍 地点
- ⏰ 时间
- 💰 价格

**当前活动数**：17个

**完整列表**（按时间排序）：
1. 孟买市场 - 00:00-24:00
2. 云南早市 - 05:00-12:00
3. 面包集市 - 07:00-11:00
4. 清迈跳蚤市集 - 07:00-14:00
5. JING JAI 市集（周末版） - 06:00-14:00
6. 椰林市集 - 08:00-14:00
7. 雨林手作市集 - 09:00-15:00
8. 瓦洛洛市场（唐人街） - 06:00-19:00
9. 艺术村市集 - 10:00-18:00
10. 复古市集 - 16:00-22:00
11. 湄卡运河集市 - 15:00-22:00
12. 白色市集 - 15:00-22:00
13. 周六夜市 - 17:00-23:00
14. 周日夜市 - 17:00-22:00
15. 清迈大学前门夜市 - 17:00-23:00
16. 长康路夜市 - 17:00-00:00
17. JING JAI 市集（工作日） - 08:30-21:00

---

### Tab 2: ⏰ 灵活时间活动

**数据筛选条件**：
```javascript
filtered = allActivities.filter(a =>
    a.flexibleTime === '是' || a.time === '灵活时间'
);
```

**包含分类**：
- 所有灵活时间活动（不限分类）
- 条件：`flexibleTime === '是'` 或 `time === '灵活时间'`

**视图类型**：列表视图
- 与市集相同的列表布局
- 按时间排序

**当前活动数**：9个

---

### Tab 3: 🏪 活动网站

**数据筛选条件**：
```javascript
filtered = allActivities.filter(a =>
    a.source && a.source.url && a.source.url.length > 0
);
```

**包含分类**：
- 所有有官方网站的活动（不限分类）
- 条件：必须包含 `source.url` 字段

**视图类型**：网站卡片视图
- 网格布局（每行最多3-4个）
- 卡片包含：
  - 🏷️ 分类标签
  - 🌐 来源名称
  - 📍 活动标题
  - 点击访问官方网站

**交互**：
- 点击卡片 → 在新标签页打开网站链接

**当前活动数**：23个

---

### Tab 4: 📖 攻略信息

**数据筛选条件**：
```javascript
// 不筛选数据，直接加载攻略内容
return [];
```

**数据来源**：
- API: `/api/guide`
- 从服务器加载富文本内容

**视图类型**：富文本内容
- 统一样式（与后台编辑器一致）
- 字体大小：h1=15px, h2/h3=14px, p/li=13px
- 自动清除内联样式，确保CSS样式生效

**内容包含**：
- 清迈旅行攻略
- 行前准备
- 注意事项
- 其他旅行信息

**当前数量**：1个页面

---

## 🔒 数据隔离机制

### 筛选流程

```
用户点击Tab
  ↓
switchTab(index) - 设置 currentTab
  ↓
updateViews() - 更新视图
  ↓
filterActivities() - 筛选数据
  ↓
第一步：根据 currentTab 筛选数据
  - Tab 0: 只包含兴趣班分类
  - Tab 1: 只包含市集分类
  - Tab 2: 只包含灵活时间活动
  - Tab 3: 只包含有网站的活动
  - Tab 4: 不筛选
  ↓
第二步：应用其他筛选条件
  - 日期筛选
  - 分类筛选
  - 价格筛选
  - 搜索筛选
  ↓
返回筛选后的数据
  ↓
更新对应视图
```

### 关键代码位置

1. **Tab导航定义**: [index.html:1316-1343](index.html#L1316-L1343)
2. **Tab筛选逻辑**: [index.html:1783-1861](index.html#L1783-L1861)
3. **视图更新逻辑**: [index.html:1959-1997](index.html#L1959-L1997)

## 📊 数据统计

| Tab | 名称 | 活动数 | 视图类型 |
|-----|------|--------|----------|
| 0 | 📅 兴趣班 | 23 | 日历视图 |
| 1 | 📋 市集 | 17 | 列表视图 |
| 2 | ⏰ 灵活时间活动 | 9 | 列表视图 |
| 3 | 🏪 活动网站 | 23 | 网站卡片 |
| 4 | 📖 攻略信息 | 1 | 富文本内容 |

**总活动数**: 47个

## ✅ 优化记录

### 2026-01-26 优化内容

1. **添加Tab数据隔离**
   - 在 `filterActivities()` 中添加Tab筛选逻辑
   - 移除 `updateViews()` 中的二次筛选
   - 确保每个Tab的数据完全独立

2. **修复数据混在一起的问题**
   - 原因：`updateViews()` 中重复筛选导致数据混乱
   - 解决：只在 `filterActivities()` 中筛选一次

3. **统一攻略信息样式**
   - 添加 `.guide-content` CSS样式
   - 与后台编辑器保持一致
   - 自动清除内联样式

4. **移除Tab数量显示**
   - 删除 `<span class="tab-count">` 元素
   - 简化界面，只显示Tab名称

## 🔄 数据流转

```
API数据 (/api/activities)
  ↓
allActivities (47个活动)
  ↓
filterActivities()
  ↓
按Tab筛选 → 兴趣班(23) / 市集(17) / 灵活时间(9) / 网站(23)
  ↓
应用其他筛选条件（日期/分类/价格/搜索）
  ↓
updateViews()
  ↓
对应视图函数
  - updateCalendarView() - 日历视图
  - updateListView() - 列表视图
  - updateWebsitesView() - 网站卡片
  - loadGuideContent() - 攻略内容
  ↓
渲染到页面
```

---

**文档版本**: v1.0
**最后更新**: 2026-01-27
**维护人**: Claude Code
