# ä¸´æ—¶æ´»åŠ¨æš‚åœ - æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

## ğŸ“‹ éœ€æ±‚èƒŒæ™¯

**åœºæ™¯**ï¼šæ´»åŠ¨0001ç‘œä¼½å› èŠ±å‰èŠ‚ç­¹å¤‡ï¼Œå…¬å›­ä»1æœˆ26æ—¥å…³é—­è‡³2æœˆ15æ—¥

**éœ€æ±‚**ï¼š
1. å…¼å®¹æœ¬åœ°JSONæ–‡ä»¶
2. å…¼å®¹æ´»åŠ¨ç®¡ç†åå°
3. æ”¯æŒå¤šç§æš‚åœç±»å‹ï¼ˆå…³é—­/å–æ¶ˆ/å‡æœŸ/ç»´æŠ¤ï¼‰
4. æ”¯æŒå¤šæ¬¡æš‚åœï¼ˆä¸æ˜¯åªæ”¯æŒä¸€æ¬¡ï¼‰
5. é•¿æœŸå¯ç”¨çš„æ–¹æ¡ˆ

---

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šåŒå­—æ®µè”åŠ¨ + æš‚åœè®°å½•æ•°ç»„

### æ–¹æ¡ˆæ¶æ„

```
status (æ•´ä½“çŠ¶æ€)
  â†“ è”åŠ¨
suspendedPeriods (æš‚åœè®°å½•æ•°ç»„)
  â†“ åŒ…å«
type + dateRange + reason
```

---

## ğŸ“ æ•°æ®ç»“æ„è®¾è®¡

### 1. æ‰©å±• status å­—æ®µ

**å½“å‰å€¼**ï¼š
```json
"status": "è¿›è¡Œä¸­"
```

**å»ºè®®æ‰©å±•ä¸º**ï¼š
```json
"status": "active" | "suspended" | "cancelled" | "completed"
```

**å­—æ®µè¯´æ˜**ï¼š
- `active` - æ´»åŠ¨æ­£å¸¸è¿›è¡Œä¸­
- `suspended` - ä¸´æ—¶æš‚åœä¸­ï¼ˆæ ¹æ®suspendedPeriodsè‡ªåŠ¨åˆ¤æ–­ï¼‰
- `cancelled` - æ´»åŠ¨æ°¸ä¹…å–æ¶ˆ
- `completed` - æ´»åŠ¨å·²ç»“æŸ

---

### 2. æ–°å¢ suspendedPeriods å­—æ®µï¼ˆæ ¸å¿ƒï¼‰

**ç»“æ„å®šä¹‰**ï¼š
```json
{
  "suspendedPeriods": [
    {
      "type": "closed",           // æš‚åœç±»å‹
      "startDate": "2026-01-26",   // å¼€å§‹æ—¥æœŸï¼ˆISO 8601ï¼‰
      "endDate": "2026-02-15",     // ç»“æŸæ—¥æœŸï¼ˆISO 8601ï¼‰
      "reason": "èŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­",
      "sourceUrl": "",             // å¯é€‰ï¼šå®˜æ–¹å…¬å‘Šé“¾æ¥
      "createdAt": "2026-01-27T10:00:00Z"  // è®°å½•åˆ›å»ºæ—¶é—´
    }
  ]
}
```

**æš‚åœç±»å‹ (type) æšä¸¾**ï¼š
```javascript
const SUSPENSION_TYPES = {
  CLOSED: 'closed',        // åœºåœ°å…³é—­
  CANCELLED: 'cancelled',  // æ´»åŠ¨å–æ¶ˆ
  HOLIDAY: 'holiday',      // èŠ‚å‡æ—¥æš‚åœ
  MAINTENANCE: 'maintenance', // ç»´æŠ¤æš‚åœ
  WEATHER: 'weather',      // å¤©æ°”åŸå› 
  SEASONAL: 'seasonal',    // å­£èŠ‚æ€§æš‚åœ
  OTHER: 'other'           // å…¶ä»–åŸå› 
}
```

---

### 3. å®Œæ•´ç¤ºä¾‹ï¼ˆæ´»åŠ¨0001ï¼‰

```json
{
  "activityNumber": "0001",
  "title": "ç‘œä¼½ï¼ˆNong Buak Haadå…¬å›­ï¼‰",
  "status": "suspended",  // â† è‡ªåŠ¨è®¡ç®—ï¼šå½“å‰åœ¨æš‚åœæœŸå†…
  "time": "08:30-09:45",
  "weekdays": ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"],
  "description": "...",

  "suspendedPeriods": [  // â† æ–°å¢å­—æ®µ
    {
      "type": "closed",
      "startDate": "2026-01-26",
      "endDate": "2026-02-15",
      "reason": "èŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­ï¼ˆ1æœˆ26æ—¥-2æœˆ15æ—¥ï¼‰",
      "sourceUrl": "https://www.facebook.com/groups/289951174859604/",
      "createdAt": "2026-01-27T10:00:00Z"
    }
  ],

  // ä¿ç•™åŸæœ‰å­—æ®µç”¨äºå…¼å®¹æ€§
  "hiddenDateBlock": {
    "startDate": "2026-01-26",
    "endDate": "2026-02-15",
    "reason": "èŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­ï¼ˆ1æœˆ26æ—¥-2æœˆ15æ—¥ï¼‰"
  }
}
```

---

## ğŸ”„ ä¼˜åŠ¿å¯¹æ¯”

### vs ç°æœ‰æ–¹æ¡ˆ (hiddenDateBlock)

| ç‰¹æ€§ | ç°æœ‰æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|------|---------|--------|
| æ”¯æŒå¤šæ¬¡æš‚åœ | âŒ åªèƒ½ä¸€æ¬¡ | âœ… æ•°ç»„æ”¯æŒå¤šæ¬¡ |
| æš‚åœç±»å‹åŒºåˆ† | âŒ æ—  | âœ… 7ç§ç±»å‹ |
| è®°å½•æº¯æº | âŒ æ—  | âœ… createdAt + sourceUrl |
| çŠ¶æ€è”åŠ¨ | âŒ éœ€æ‰‹åŠ¨æ”¹status | âœ… è‡ªåŠ¨è®¡ç®— |
| å‘åå…¼å®¹ | N/A | âœ… ä¿ç•™hiddenDateBlock |

---

## ğŸ’» å®ç°ä»£ç 

### 1. åå°ç®¡ç†ç³»ç»Ÿ - æ·»åŠ æš‚åœè®°å½•

```javascript
// åå°API: POST /api/activities/{id}/suspensions
async function addSuspension(activityId, suspensionData) {
  const activity = await Activity.findById(activityId);

  activity.suspendedPeriods = activity.suspendedPeriods || [];
  activity.suspendedPeriods.push({
    ...suspensionData,
    createdAt: new Date().toISOString()
  });

  // è‡ªåŠ¨æ›´æ–°status
  activity.status = calculateStatus(activity);

  // æ›´æ–°hiddenDateBlockï¼ˆå…¼å®¹æ€§ï¼‰
  activity.hiddenDateBlock = {
    startDate: suspensionData.startDate,
    endDate: suspensionData.endDate,
    reason: suspensionData.reason
  };

  await activity.save();
  return activity;
}
```

### 2. å‰ç«¯åˆ¤æ–­å‡½æ•°

```javascript
/**
 * æ£€æŸ¥æ´»åŠ¨åœ¨æŒ‡å®šæ—¥æœŸæ˜¯å¦æš‚åœ
 * @param {Object} activity - æ´»åŠ¨å¯¹è±¡
 * @param {Date} date - æ£€æŸ¥æ—¥æœŸï¼Œé»˜è®¤ä¸ºä»Šå¤©
 * @returns {Object|null} - è¿”å›æš‚åœè®°å½•æˆ–null
 */
function isSuspendedOn(activity, date = new Date()) {
  if (!activity.suspendedPeriods || activity.suspendedPeriods.length === 0) {
    return null;
  }

  const checkDate = date.toISOString().split('T')[0]; // YYYY-MM-DD

  return activity.suspendedPeriods.find(period => {
    return checkDate >= period.startDate && checkDate <= period.endDate;
  });
}

/**
 * è‡ªåŠ¨è®¡ç®—æ´»åŠ¨çŠ¶æ€
 */
function calculateStatus(activity) {
  const currentSuspension = isSuspendedOn(activity);

  if (currentSuspension) {
    return 'suspended';
  }

  // å¯æ‰©å±•å…¶ä»–çŠ¶æ€åˆ¤æ–­é€»è¾‘
  return 'active';
}
```

### 3. å‰ç«¯å±•ç¤ºç¤ºä¾‹

```jsx
function ActivityCard({ activity }) {
  const suspension = isSuspendedOn(activity);

  if (suspension) {
    return (
      <div className="activity-card suspended">
        <h3>{activity.title}</h3>
        <div className="suspension-alert">
          <span className="icon">â¸ï¸</span>
          <span className="type">{getSuspensionTypeLabel(suspension.type)}</span>
          <span className="date">
            {suspension.startDate} è‡³ {suspension.endDate}
          </span>
        </div>
        <p className="reason">{suspension.reason}</p>
        {suspension.sourceUrl && (
          <a href={suspension.sourceUrl} target="_blank">æŸ¥çœ‹å®˜æ–¹å…¬å‘Š</a>
        )}
      </div>
    );
  }

  return <NormalActivityCard activity={activity} />;
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¿ç§»è„šæœ¬

```javascript
// migration_add_suspended_periods.js
module.exports = {
  async up(db) {
    const activities = await db.collection('activities').find({}).toArray();

    for (const activity of activities) {
      if (activity.hiddenDateBlock) {
        // è¿ç§»ç°æœ‰hiddenDateBlockæ•°æ®
        await db.collection('activities').updateOne(
          { _id: activity._id },
          {
            $set: {
              suspendedPeriods: [
                {
                  type: 'other',
                  startDate: activity.hiddenDateBlock.startDate,
                  endDate: activity.hiddenDateBlock.endDate,
                  reason: activity.hiddenDateBlock.reason,
                  createdAt: new Date().toISOString()
                }
              ],
              status: 'suspended' // ä¸´æ—¶è®¾ç½®ä¸ºsuspendedï¼Œç”±å‰ç«¯åŠ¨æ€è®¡ç®—
            }
          }
        );
      }
    }
  },

  async down(db) {
    await db.collection('activities').updateMany(
      { suspendedPeriods: { $exists: true } },
      {
        $unset: { suspendedPeriods: '' }
      }
    );
  }
};
```

---

## ğŸ“Š ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šå•æ¬¡æš‚åœï¼ˆå¦‚0001ç‘œä¼½ï¼‰
```json
{
  "suspendedPeriods": [
    {
      "type": "closed",
      "startDate": "2026-01-26",
      "endDate": "2026-02-15",
      "reason": "èŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­"
    }
  ]
}
```

### åœºæ™¯2ï¼šå¤šæ¬¡æš‚åœï¼ˆå¦‚å­£èŠ‚æ€§æ´»åŠ¨ï¼‰
```json
{
  "suspendedPeriods": [
    {
      "type": "seasonal",
      "startDate": "2026-03-01",
      "endDate": "2026-05-31",
      "reason": "çƒ­å­£æš‚åœ"
    },
    {
      "type": "holiday",
      "startDate": "2026-12-25",
      "endDate": "2026-12-26",
      "reason": "åœ£è¯èŠ‚æš‚åœ"
    }
  ]
}
```

### åœºæ™¯3ï¼šé•¿æœŸå–æ¶ˆ
```json
{
  "status": "cancelled",
  "suspendedPeriods": [
    {
      "type": "cancelled",
      "startDate": "2026-01-20",
      "endDate": "2099-12-31",  // è¿œæœŸæ—¥æœŸè¡¨ç¤ºæ°¸ä¹…
      "reason": "ä¸»åŠæ–¹æ°¸ä¹…åœæ­¢æ´»åŠ¨"
    }
  ]
}
```

---

## âœ… å®æ–½æ­¥éª¤

### Phase 1: æ•°æ®ç»“æ„å‡çº§ï¼ˆ1å°æ—¶ï¼‰
1. âœ… æ›´æ–°JSON Schemaï¼Œæ·»åŠ suspendedPeriodså­—æ®µ
2. âœ… è¿ç§»0001æ´»åŠ¨çš„hiddenDateBlockæ•°æ®
3. âœ… ç¼–å†™æ•°æ®éªŒè¯è„šæœ¬

### Phase 2: å‰ç«¯å±•ç¤ºä¼˜åŒ–ï¼ˆ2å°æ—¶ï¼‰
1. âœ… å®ç°isSuspendedOn()åˆ¤æ–­å‡½æ•°
2. âœ… æ·»åŠ æš‚åœçŠ¶æ€UIç»„ä»¶
3. âœ… æ›´æ–°æ´»åŠ¨å¡ç‰‡å±•ç¤ºé€»è¾‘

### Phase 3: åå°ç®¡ç†ç³»ç»Ÿï¼ˆ3å°æ—¶ï¼‰
1. âœ… æ·»åŠ æš‚åœè®°å½•ç®¡ç†ç•Œé¢
2. âœ… å®ç°æ·»åŠ /ç¼–è¾‘/åˆ é™¤æš‚åœè®°å½•API
3. âœ… æ·»åŠ æš‚åœç±»å‹ä¸‹æ‹‰é€‰æ‹©

### Phase 4: ExcelåŒæ­¥ï¼ˆ1å°æ—¶ï¼‰
1. âœ… æ›´æ–°Excelå¯¼å‡ºé€»è¾‘ï¼ŒåŒ…å«æš‚åœä¿¡æ¯
2. âœ… æ·»åŠ æš‚åœçŠ¶æ€åˆ—

---

## ğŸ¨ UI/UX å»ºè®®

### å‰ç«¯æš‚åœçŠ¶æ€å±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§˜ ç‘œä¼½ï¼ˆNong Buak Haadå…¬å›­ï¼‰       â”‚
â”‚  â¸ï¸ æš‚åœä¸­                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“… æš‚åœæ—¶é—´ï¼š1æœˆ26æ—¥ - 2æœˆ15æ—¥      â”‚
â”‚  ğŸ“ åŸå› ï¼šèŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­         â”‚
â”‚  ğŸ”— æŸ¥çœ‹å®˜æ–¹å…¬å‘Š                     â”‚
â”‚  âœ… é¢„è®¡2æœˆ16æ—¥æ¢å¤                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åå°ç®¡ç†ç•Œé¢

```
â”Œâ”€ æš‚åœè®°å½•ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚  [+ æ·»åŠ æš‚åœè®°å½•]                   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç±»å‹ï¼šåœºåœ°å…³é—­      [â–¼]      â”‚  â”‚
â”‚  â”‚ å¼€å§‹æ—¥æœŸï¼š2026-01-26  [ğŸ“…]   â”‚  â”‚
â”‚  â”‚ ç»“æŸæ—¥æœŸï¼š2026-02-15  [ğŸ“…]   â”‚  â”‚
â”‚  â”‚ åŸå› ï¼šèŠ±å‰èŠ‚æœŸé—´å…¬å›­å…³é—­      â”‚  â”‚
â”‚  â”‚ å…¬å‘Šé“¾æ¥ï¼š[å¯é€‰]              â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ [å–æ¶ˆ]  [ä¿å­˜]               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  å†å²è®°å½•ï¼š                          â”‚
â”‚  â€¢ 2026-01-26 è‡³ 2026-02-15 åœºåœ°å…³é—­ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ç›¸å…³å­—æ®µå¯¹æ¯”

| å­—æ®µå | ç”¨é€” | ä¿ç•™/æ–°å¢ | è¯´æ˜ |
|--------|------|----------|------|
| `status` | æ•´ä½“çŠ¶æ€ | âœ… ä¿ç•™ | æ‰©å±•æšä¸¾å€¼ |
| `suspendedPeriods` | æš‚åœè®°å½•æ•°ç»„ | âœ¨ æ–°å¢ | æ ¸å¿ƒå­—æ®µ |
| `hiddenDateBlock` | ä¸´æ—¶éšè— | â¸ï¸ å¼ƒç”¨ | ä¿ç•™ç”¨äºå…¼å®¹ |
| `flexibleTime` | æ—¶é—´çµæ´»æ€§ | âœ… ä¿ç•™ | ä¸å—å½±å“ |
| `timeInfo` | æ—¶é—´ä¿¡æ¯ | âœ… ä¿ç•™ | ä¸å—å½±å“ |

---

## ğŸ“ å¤‡æ³¨

1. **å‘åå…¼å®¹**ï¼šä¿ç•™hiddenDateBlockå­—æ®µï¼Œç¡®ä¿æ—§ä»£ç æ­£å¸¸è¿è¡Œ
2. **æ•°æ®éªŒè¯**ï¼š startDate <= endDateï¼ˆå¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸï¼‰
3. **æ—¶åŒºå¤„ç†**ï¼šæ‰€æœ‰æ—¥æœŸä½¿ç”¨ISO 8601æ ¼å¼ï¼ˆYYYY-MM-DDï¼‰
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸ºsuspendedPeriodsåˆ›å»ºæ•°æ®åº“ç´¢å¼•
5. **å‰ç«¯ç¼“å­˜**ï¼šstatusç”±å‰ç«¯åŠ¨æ€è®¡ç®—ï¼Œå‡å°‘æ•°æ®åº“å†™å…¥

---

**ç”Ÿæˆæ—¶é—´**ï¼š2026-01-27
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æ–¹æ¡ˆçŠ¶æ€**ï¼šâœ… å¾…å®¡æ ¸
