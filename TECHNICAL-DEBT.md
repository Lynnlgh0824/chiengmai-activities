# 技术债务日志 (Technical Debt Log)

> **定义**：技术债务是为了短期速度而牺牲长期质量的权宜之计。
>
> **原则**：债务必须记录、有计划、定期偿还。

---

## 📊 债务概览

| 类别 | 数量 | 高优先级 | 中优先级 | 低优先级 |
|------|------|---------|---------|---------|
| 代码质量 | 3 | 1 | 2 | 0 |
| 性能优化 | 2 | 1 | 1 | 0 |
| 文档缺失 | 1 | 0 | 0 | 1 |
| 测试覆盖 | 1 | 1 | 0 | 0 |
| **总计** | **7** | **3** | **3** | **1** |

---

## 🔴 高优先级债务（建议 2 周内解决）

### 1. 缺少单元测试
**位置**：全项目
**影响**：高风险 - 修改代码时容易引入回归 Bug
**债务时间**：2025-01-30
**预估工作量**：3-5 天

**问题**：
- 没有自动化测试
- 每次修改都要手动测试所有场景
- 无法快速验证边界情况

**解决方案**：
- [ ] 为核心函数添加单元测试（Jest/Vitest）
  - `filterActivities()`
  - `toggleDayFilter()`
  - `renderCalendarGrid()`
  - `switchTab()`
- [ ] 为关键流程添加集成测试
  - 日期筛选流程
  - Tab 切换流程
  - 搜索功能
- [ ] 配置 CI/CD 自动运行测试

**验收标准**：
- 测试覆盖率 > 60%
- 所有 PR 必须通过测试才能合并
- CI/CD 自动运行测试

**负责人**：待分配
**截止日期**：2025-02-15

---

### 2. 移动端滚动性能优化
**位置**：`public/index.html`（日历列表渲染）
**影响**：用户体验 - 长列表滚动卡顿
**债务时间**：2025-01-29
**预估工作量**：1-2 天

**问题**：
- 移动端日历列表一次性渲染所有活动
- 没有虚拟滚动或分页
- 滚动时可能出现掉帧

**解决方案**：
- [ ] 实现虚拟滚动（react-window/virtual-list）
- [ ] 或者实现分页加载（每次加载 20 项）
- [ ] 使用 `requestAnimationFrame` 优化滚动
- [ ] 添加骨架屏提升感知性能

**验收标准**：
- 滚动 FPS > 55（使用 Lighthouse 测试）
- 首屏渲染时间 < 1.5s
- 滚动无卡顿感

**负责人**：待分配
**截止日期**：2025-02-10

---

### 3. 硬编码的魔法数字
**位置**：`public/index.html`
**影响**：可维护性 - 代码难以理解和修改
**债务时间**：2025-01-30
**预估工作量**：半天

**问题**：
```javascript
// ❌ 硬编码的延迟时间
setTimeout(() => { isPageFirstLoad = false; }, 1000);
setTimeout(() => { initH5ScrollAutoSelect(gridId); }, 1000);

// ❌ 硬编码的判断条件
if (entry.intersectionRatio >= 0.5) {
    // ...
}
```

**解决方案**：
- [ ] 提取常量到配置对象
  ```javascript
  const CONFIG = {
      PAGE_LOAD_DELAY: 1000,
      SCROLL_OBSERVER_DELAY: 1000,
      INTERSECTION_THRESHOLD: 0.5,
      TOAST_DURATION: 2000
  };
  ```
- [ ] 使用语义化命名
- [ ] 添加注释说明为什么是这个值

**验收标准**：
- 所有魔法数字都有常量定义
- 常量有清晰的命名和注释
- 修改常量不需要搜索代码

**负责人**：待分配
**截止日期**：2025-02-05

---

## 🟡 中优先级债务（建议 1 个月内解决）

### 4. 缺少错误边界（Error Boundary）
**位置**：全项目
**影响**：风险控制 - JavaScript 错误可能导致白屏
**债务时间**：2025-01-30
**预估工作量**：2-3 天

**问题**：
- 没有全局错误处理
- `fetchActivities()` 失败时没有友好的错误提示
- 没有错误上报机制

**解决方案**：
- [ ] 添加全局错误监听器
  ```javascript
  window.addEventListener('error', (e) => {
      logError(e.error);
      showUserFriendlyError();
  });
  window.addEventListener('unhandledrejection', (e) => {
      logError(e.reason);
      showUserFriendlyError();
  });
  ```
- [ ] 关键函数添加 try/catch
  - `fetchActivities()`
  - `updateViews()`
  - `renderCalendarGrid()`
- [ ] 添加错误上报（可选：Sentry、Bugsnag）

**验收标准**：
- 所有 JavaScript 错误都被捕获
- 用户看到友好的错误提示
- 开发者能收到错误日志

**负责人**：待分配
**截止日期**：2025-02-28

---

### 5. CSS 样式冗余和重复
**位置**：`public/index.html`（`<style>` 标签）
**影响**：性能 - CSS 文件过大（~3000 行）
**债务时间**：2025-01-29
**预估工作量**：1-2 天

**问题**：
- 大量重复的样式代码
- 未使用的 CSS 类（移除组件后的残留）
- 没有使用 CSS 变量统一设计系统

**解决方案**：
- [ ] 提取 CSS 变量
  ```css
  :root {
      --color-primary: #667eea;
      --color-secondary: #764ba2;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      /* ... */
  }
  ```
- [ ] 删除未使用的 CSS 类
- [ ] 合并重复的样式规则
- [ ] 考虑迁移到独立的 CSS 文件

**验收标准**：
- CSS 减少至少 20%
- 没有未使用的类
- 使用 CSS 变量管理颜色、间距

**负责人**：待分配
**截止日期**：2025-02-20

---

### 6. 缺少 API 响应缓存
**位置**：`fetchActivities()`
**影响**：性能 - 重复请求相同数据
**债务时间**：2025-01-30
**预估工作量**：1 天

**问题**：
- 每次刷新页面都重新请求数据
- 活动数据不常变化，可以缓存
- 没有离线支持

**解决方案**：
- [ ] 添加 localStorage 缓存（TTL: 1小时）
  ```javascript
  const cacheKey = 'chiengmai_activities';
  const cache = localStorage.getItem(cacheKey);
  if (cache) {
      const data = JSON.parse(cache);
      if (Date.now() - data.timestamp < 3600000) {
          return data.activities;
      }
  }
  ```
- [ ] 添加 Service Worker 支持离线访问
- [ ] 添加"刷新"按钮手动更新数据

**验收标准**：
- 二次访问直接从缓存加载（<100ms）
- 缓存过期后自动更新
- 离线时显示缓存数据

**负责人**：待分配
**截止日期**：2025-02-15

---

## 🟢 低优先级债务（可延后处理）

### 7. README 更新
**位置**：`README.md`
**影响**：文档缺失
**债务时间**：2025-01-30
**预估工作量**：1 小时

**问题**：
- 缺少快速开始指南
- 缺少项目结构说明
- 缺少贡献指南

**解决方案**：
- [ ] 添加"快速开始"部分
- [ ] 添加"项目结构"部分
- [ ] 添加"开发指南"部分
- [ ] 添加"部署指南"部分

**验收标准**：
- 新开发者能在 10 分钟内运行项目
- 了解项目目录结构
- 知道如何参与贡献

**负责人**：待分配
**截止日期**：2025-03-31

---

## 📅 偿还计划（Timeline）

### 第 1 周（2025-02-03 ~ 2025-02-09）
- [ ] ✅ 创建 CHECKLIST.md
- [ ] ✅ 创建 TECHNICAL-DEBT.md
- [ ] 🔄 添加 Pre-commit Hook
- [ ] 🔄 解决债务 #3：硬编码的魔法数字

### 第 2 周（2025-02-10 ~ 2025-02-16）
- [ ] 🔄 解决债务 #2：移动端滚动性能优化
- [ ] 🔄 解决债务 #6：添加 API 响应缓存

### 第 3 周（2025-02-17 ~ 2025-02-23）
- [ ] 🔄 解决债务 #5：CSS 样式冗余和重复

### 第 4 周（2025-02-24 ~ 2025-03-02）
- [ ] 🔄 解决债务 #4：缺少错误边界
- [ ] 🔄 解决债务 #1：添加单元测试（核心功能）

### 后续（2025-03-03 ~ 2025-03-31）
- [ ] 🔄 解决债务 #7：README 更新
- [ ] 🔄 代码审查和重构

---

## 📝 债务记录模板

```markdown
### N. 债务标题
**位置**：文件路径或函数名
**影响**：性能/安全/可维护性 - 具体问题描述
**债务时间**：YYYY-MM-DD
**预估工作量**：X 天/小时

**问题**：
具体描述问题

**解决方案**：
- [ ] 任务 1
- [ ] 任务 2

**验收标准**：
- [ ] 标准 1
- [ ] 标准 2

**负责人**：待分配
**截止日期**：YYYY-MM-DD
```

---

## 🔔 债务提醒机制

### 自动提醒
- [ ] 每周五检查技术债务列表
- [ ] 每月评估债务优先级
- [ ] 每季度计划偿还高优先级债务

### 手动提醒
- 代码审查时发现新债务，立即记录
- 重构时顺便记录相关债务
- 技术分享时讨论债务优先级

---

## 📊 债务统计

### 按类别
- **代码质量**：3 项
- **性能优化**：2 项
- **文档缺失**：1 项
- **测试覆盖**：1 项

### 按状态
- **待处理**：7 项
- **进行中**：0 项
- **已完成**：0 项

### 按优先级
- **高**：3 项
- **中**：3 项
- **低**：1 项

---

## 🎯 偿还原则

### 1. 先还高利息债务
- 安全问题 > 性能问题 > 可维护性问题
- 用户影响 > 开发效率 > 代码美观

### 2. 偿还时避免新增债务
- 重构时不要引入新的技术债务
- 如果必须新增，立即记录

### 3. 定期评估
- 每月评估债务优先级是否变化
- 每季度检查是否还有遗漏的债务

### 4. 团队共识
- 偿还债务需要团队统一认识
- 不要单独行动，避免冲突

---

## 🔗 相关文档

- [CHECKLIST.md](./CHECKLIST.md) - 代码审查检查清单
- [docs/removed-components.md](./docs/removed-components.md) - 已移除组件记录
- [README.md](./README.md) - 项目说明

---

**最后提醒**：

> "技术债务就像金融债务，适度可以加速发展，过度会导致破产。"
>
> 保持记录、定期偿还、避免恶性循环。

**更新日期**：2025-01-30
**下次审查**：2025-02-28
