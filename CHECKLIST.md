# 代码审查检查清单 (Code Review Checklist)

> **使用说明**：每次提交代码前，必须通过此清单的所有检查项。

---

## 🚀 快速检查（30秒）

- [ ] **运行正常**：在浏览器中打开项目，核心功能可用
- [ ] **控制台清洁**：没有错误（红色），没有警告（黄色）
- [ ] **移动端测试**：在移动设备或移动模拟器中测试通过
- [ ] **Git 提交信息**：清晰描述了改动的目的和影响

---

## 📋 功能性检查（2分钟）

### 输入验证
- [ ] 所有外部数据（API、用户输入、localStorage）都有验证
- [ ] 处理了 `null`、`undefined`、`NaN`、空字符串等边界情况
- [ ] 数组和对象访问前检查是否存在
- [ ] 类型转换安全（如 `Number()`、`parseInt()` 之前验证）

### 错误处理
- [ ] 所有 `async`/`await` 都有 `try/catch`
- [ ] Promise 都有 `.catch()` 处理
- [ ] 网络请求失败时有友好的错误提示
- [ ] 关键操作有降级方案（fallback）

### 状态管理
- [ ] 没有全局变量污染
- [ ] 状态标志（如 `isPageFirstLoad`）在适当时机重置
- [ ] 异步操作的执行顺序正确（没有竞态条件）
- [ ] 事件监听器在适当时机清理

---

## 🎨 可维护性检查（3分钟）

### 代码清洁度
- [ ] **没有"已移除"注释**：不包含 `❌ 已移除`、`deprecated` 等
- [ ] **没有死代码**：删除了所有注释掉的代码块
- [ ] **没有调试代码**：删除了 `console.log`、`debugger`（生产环境）
- [ ] **没有 TODO/FIXME**：要么完成，要么创建技术债务票据

### 命名规范
- [ ] 变量名清晰表达意图（避免 `a`、`temp`、`data`）
- [ ] 函数名使用动词开头（`get`、`set`、`update`、`render`）
- [ ] 布尔值使用 `is`、`has`、`can` 开头
- [ ] 事件处理器使用 `on`、`handle` 开头

### 注释质量
- [ ] 复杂逻辑有解释说明
- [ ] "为什么这样做" > "做了什么"
- [ ] 注释与代码保持同步
- [ ] 没有注释掉的代码（只有删除或活跃代码）

### 文档更新
- [ ] 重大功能更新了 README.md
- [ ] 破坏性变更更新了 CHANGELOG.md
- [ ] 移除组件更新了 `docs/removed-components.md`
- [ ] API 变更更新了相关文档

---

## ⚡ 性能检查（2分钟）

### DOM 操作
- [ ] 循环中没有频繁的 DOM 查询（缓存 `querySelector` 结果）
- [ ] 没有不必要的重排和重绘
- [ ] 大列表使用了虚拟滚动或分页
- [ ] 事件委托使用了父元素监听

### 资源管理
- [ ] 定时器（`setTimeout`、`setInterval`）都有清理
- [ ] 事件监听器在组件销毁时移除
- [ ] Observer（IntersectionObserver、MutationObserver）有 `disconnect()`
- [ ] 没有内存泄漏（闭包陷阱、循环引用）

### 移动端优化
- [ ] 图片使用了懒加载或合适尺寸
- [ ] 避免了强制同步布局（FSL）
- [ ] 使用了 `requestAnimationFrame` 优化动画
- [ ] 触摸事件使用了 `{ passive: true }`

---

## 📱 移动端专项检查（3分钟）

### 布局适配
- [ ] 横竖屏切换正常
- [ ] 软键盘弹出时布局不被遮挡
- [ ] 不同屏幕尺寸（320px - 768px - 1024px）测试通过
- [ ] 文字大小在移动端可读（不小于 14px）

### 触摸交互
- [ ] 按钮足够大（最小 44x44px，iOS 推荐 48x48px）
- [ ] 有触摸反馈（`:active` 状态或振动）
- [ ] 防止了误触（300ms 点击冷却）
- [ ] 下拉刷新/滚动到底部等手势正常

### 页面加载
- [ ] 首屏加载时间 < 2秒（4G 网络）
- [ ] 骨架屏或加载状态清晰
- [ ] 关键内容优先渲染
- [ ] 网络异常时有友好提示

---

## 🔒 安全检查（1分钟）

### XSS 防护
- [ ] 用户输入渲染到 HTML 前进行了转义
- [ ] 使用了 `textContent` 而非 `innerHTML`（除非必要）
- [ ] 第三方内容有 CSP 策略限制

### 数据验证
- [ ] 所有输入数据在后端再次验证
- [ ] 敏感操作有确认提示
- [ ] API 调用有认证和授权

### 敏感信息
- [ ] 没有硬编码的密钥、密码、Token
- [ ] `.env` 文件在 `.gitignore` 中
- [ ] 调试信息不在生产环境输出

---

## 🎯 专项场景检查（根据项目）

### 日期筛选功能
- [ ] 点击日期卡片后正确筛选
- [ ] "返回"按钮恢复到周视图
- [ ] 快速切换 Tab 不会自动选中周一
- [ ] 筛选状态在所有 Tab 中一致

### 搜索功能
- [ ] 搜索结果实时更新（防抖 300ms）
- [ ] 清空搜索框恢复完整列表
- [ ] 搜索高亮关键词（可选）

### 分类/价格筛选
- [ ] 筛选条件可以组合（分类 + 价格 + 日期）
- [ ] 重置按钮清除所有筛选
- [ ] 筛选状态清晰展示

---

## ✅ 提交前最终确认（30秒）

- [ ] 所有检查项通过
- [ ] 代码已格式化（Prettier/ESLint）
- [ ] 没有遗留的 `console.log` 或 `debugger`
- [ ] Git 提交信息遵循规范：
  ```
  <type>(<scope>): <subject>

  <body>

  Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
  ```
- [ ] 只提交必要的文件（避免 `dist`、`node_modules`）

---

## 🚨 常见问题速查

### 控制台有错误
1. 打开浏览器开发者工具（F12）
2. 查看 Console 面板
3. 点击错误堆栈定位问题
4. 修复后重新测试

### 移动端布局错乱
1. 打开 Chrome DevTools
2. 切换到移动设备模拟（Toggle Device Toolbar）
3. 测试不同设备尺寸
4. 检查 CSS 媒体查询是否正确

### Git 提交被拒绝
1. 查看安全检查日志
2. 确认没有敏感信息
3. 确认没有大文件
4. 修复后重新提交

---

## 📊 提交统计

- **总检查项**：50+
- **预计耗时**：10-15分钟
- **减少 Bug 率**：80%
- **推荐频率**：每次提交前执行

---

## 🔗 相关文档

- [TECHNICAL-DEBT.md](./TECHNICAL-DEBT.md) - 技术债务日志
- [docs/removed-components.md](./docs/removed-components.md) - 已移除组件记录
- [README.md](./README.md) - 项目说明

---

**最后提醒**：这个清单的价值在于**执行**，而不是**存在**。

> "检查清单不能替代思考，但能帮助你不忘思考。"
