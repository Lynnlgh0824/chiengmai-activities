<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨åŒ–æµ‹è¯•ä»ªè¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .test-status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-running { background: #cff4fc; color: #055160; animation: pulse 1.5s infinite; }
        .status-pass { background: #d1e7dd; color: #0f5132; }
        .status-fail { background: #f8d7da; color: #842029; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .test-suite {
            margin: 25px 0;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }
        .test-suite-header {
            background: #f8f9fa;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .test-suite-header:hover {
            background: #e9ecef;
        }
        .test-suite-header h3 {
            font-size: 18px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-suite-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-pending { background: #6c757d; color: white; }
        .badge-running { background: #0dcaf0; color: white; }
        .badge-pass { background: #198754; color: white; }
        .badge-fail { background: #dc3545; color: white; }

        .test-items {
            display: none;
            padding: 20px;
            background: white;
        }
        .test-items.show {
            display: block;
        }

        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #dee2e6;
        }
        .test-item.pass { border-left-color: #198754; background: #f0fff4; }
        .test-item.fail { border-left-color: #dc3545; background: #fff5f5; }

        .test-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-item-header h4 {
            font-size: 15px;
            color: #333;
        }
        .test-item-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-icon-pass { color: #198754; font-size: 18px; }
        .status-icon-fail { color: #dc3545; font-size: 18px; }

        .test-details {
            margin-top: 10px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #666;
            white-space: pre-wrap;
        }

        .actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5c636a;
        }

        .summary {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f4ff 100%);
            border-radius: 12px;
            display: none;
        }
        .summary.show {
            display: block;
        }
        .summary h2 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        .summary-card {
            padding: 20px;
            background: white;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .summary-card .number {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        .summary-card .label {
            font-size: 13px;
            color: #666;
        }
        .summary-card.pass .number { color: #198754; }
        .summary-card.fail .number { color: #dc3545; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .console-output {
            margin-top: 20px;
            padding: 15px;
            background: #1e1e1e;
            border-radius: 8px;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .console-output.show {
            display: block;
        }
        .console-line {
            margin: 5px 0;
        }
        .console-line.success { color: #4ec9b0; }
        .console-line.error { color: #f48771; }
        .console-line.info { color: #9cdcfe; }

        .chevron {
            transition: transform 0.3s;
        }
        .chevron.open {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ¸…è¿ˆæ´»åŠ¨ - è‡ªåŠ¨åŒ–æµ‹è¯•ä»ªè¡¨æ¿
            <span id="overallStatus" class="test-status status-pending">å¾…æµ‹è¯•</span>
        </h1>
        <p class="subtitle">å…¨é¢çš„å‰åç«¯è‡ªåŠ¨åŒ–æµ‹è¯• â€¢ å®æ—¶åé¦ˆ â€¢ è¯¦ç»†æŠ¥å‘Š</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%"></div>
        </div>

        <div id="testResults"></div>

        <div class="actions">
            <button class="btn btn-primary" id="runAllBtn" onclick="runAllTests()">
                <span>â–¶ï¸</span>
                <span>è¿è¡Œæ‰€æœ‰æµ‹è¯•</span>
            </button>
            <button class="btn btn-secondary" onclick="location.reload()">
                <span>ğŸ”„</span>
                <span>é‡æ–°åŠ è½½</span>
            </button>
            <button class="btn btn-secondary" onclick="toggleConsole()">
                <span>ğŸ“‹</span>
                <span>æŸ¥çœ‹æ—¥å¿—</span>
            </button>
        </div>

        <div class="summary" id="summary">
            <h2>ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="number" id="totalSuites">0</div>
                    <div class="label">æµ‹è¯•å¥—ä»¶</div>
                </div>
                <div class="summary-card pass">
                    <div class="number" id="passCount">0</div>
                    <div class="label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="summary-card fail">
                    <div class="number" id="failCount">0</div>
                    <div class="label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="summary-card">
                    <div class="number" id="passRate">0%</div>
                    <div class="label">é€šè¿‡ç‡</div>
                </div>
            </div>
        </div>

        <div class="console-output" id="consoleOutput"></div>
    </div>

    <script>
        // æµ‹è¯•å¥—ä»¶é…ç½®
        const testSuites = [
            {
                name: 'éŸ³ä¹TabåŠŸèƒ½æµ‹è¯•',
                icon: 'ğŸµ',
                file: 'test-music-tab.cjs',
                tests: [
                    'Tabæ•°é‡æ£€æŸ¥ï¼ˆ6ä¸ªï¼‰',
                    'éŸ³ä¹Tabå­˜åœ¨',
                    'éŸ³ä¹å›¾æ ‡æ­£ç¡®',
                    'éŸ³ä¹Tabå†…å®¹åŒºåŸŸ',
                    'updateViewsæ”¯æŒéŸ³ä¹Tab',
                    'filterActivitiesæ”¯æŒéŸ³ä¹Tab',
                    'åˆ†ç±»ç­›é€‰å™¨æ’é™¤éŸ³ä¹',
                    'å…´è¶£ç­æ’é™¤éŸ³ä¹',
                    'Tabç´¢å¼•æ­£ç¡®æ›´æ–°',
                    'updateCalendarViewæ”¯æŒéŸ³ä¹Tab',
                    'Tabæ•°é‡ç»Ÿè®¡åŒ…å«éŸ³ä¹'
                ]
            },
            {
                name: 'æ—¶é—´æ’åºåŠŸèƒ½æµ‹è¯•',
                icon: 'â°',
                file: 'test-time-sorting.cjs',
                tests: [
                    'æ—¶é—´æ’åºå‡½æ•°å­˜åœ¨',
                    'æ—¶é—´æå–é€»è¾‘',
                    'æ•°å­—æ¯”è¾ƒé€»è¾‘',
                    'å•ä¸€æ—¶é—´ç‚¹ä¼˜å…ˆ',
                    'æ—¶é—´æ®µç»“æŸæ—¶é—´æ’åº',
                    'æ—¶é—´æ ¼å¼æ”¯æŒ',
                    'æ’åºè°ƒç”¨ç‚¹',
                    'æ—¥å†è§†å›¾æ’åº'
                ]
            },
            {
                name: 'APIç«¯ç‚¹æµ‹è¯•',
                icon: 'ğŸŒ',
                file: 'test-api-endpoints.cjs',
                tests: [
                    'GET /api/health - å¥åº·æ£€æŸ¥',
                    'GET /api/activities - è·å–æ‰€æœ‰æ´»åŠ¨',
                    'æ•°æ®ç»“æ„éªŒè¯',
                    'GET /api/categories - è·å–åˆ†ç±»',
                    'æ•°æ®å®Œæ•´æ€§éªŒè¯',
                    'çµæ´»æ—¶é—´æ´»åŠ¨éªŒè¯'
                ]
            },
            {
                name: 'åˆ†ç±»ç­›é€‰æµ‹è¯•',
                icon: 'ğŸ·ï¸',
                file: 'test-category-filter.cjs',
                tests: [
                    'åˆ†ç±»ç­›é€‰å™¨åˆå§‹åŒ–',
                    'æ’é™¤å¸‚é›†åˆ†ç±»',
                    'æ’é™¤éŸ³ä¹åˆ†ç±»',
                    'åˆ†ç±»æŒ‰é’®ç‚¹å‡»å¤„ç†',
                    'ç­›é€‰å™¨å®¹å™¨',
                    'ç­›é€‰é€»è¾‘',
                    'åˆ†ç±»å­—æ®µ',
                    'å…¨éƒ¨åˆ†ç±»é€‰é¡¹'
                ]
            },
            {
                name: 'æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•',
                icon: 'âš™ï¸',
                file: 'test-core-functions.cjs',
                tests: [
                    'Tabåˆ‡æ¢å‡½æ•°',
                    '6ä¸ªTabå…¨éƒ¨å­˜åœ¨',
                    'æ´»åŠ¨ç­›é€‰å‡½æ•°',
                    'ç­›é€‰å™¨è®¾ç½®å‡½æ•°',
                    'æ—¥å†è§†å›¾æ›´æ–°å‡½æ•°',
                    'æ—¥æœŸç½‘æ ¼å®¹å™¨',
                    'æ•°æ®åŠ è½½é€»è¾‘',
                    'æ´»åŠ¨å¡ç‰‡æ¸²æŸ“é€»è¾‘',
                    'Tabå†…å®¹åŒºåŸŸ',
                    'æ—¶é—´æ’åºé€»è¾‘',
                    'å½“å‰TabçŠ¶æ€',
                    'å½“å‰ç­›é€‰æ¡ä»¶'
                ]
            }
        ];

        let consoleLines = [];

        function log(message, type = 'info') {
            consoleLines.push({ message, type, time: new Date().toLocaleTimeString() });
            updateConsole();
        }

        function updateConsole() {
            const consoleOutput = document.getElementById('consoleOutput');
            consoleOutput.innerHTML = consoleLines.map(line =>
                `<div class="console-line ${line.type}">[${line.time}] ${line.message}</div>`
            ).join('');
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function toggleConsole() {
            document.getElementById('consoleOutput').classList.toggle('show');
        }

        function toggleSuite(index) {
            const items = document.querySelectorAll('.test-items')[index];
            const chevron = document.querySelectorAll('.chevron')[index];
            items.classList.toggle('show');
            chevron.classList.toggle('open');
        }

        async function runTest(suiteIndex, testIndex) {
            const suite = testSuites[suiteIndex];
            const testName = suite.tests[testIndex];

            log(`è¿è¡Œ: ${suite.name} - ${testName}`, 'info');

            // æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆåœ¨å®é™…ç¯å¢ƒä¸­ä¼šè°ƒç”¨APIï¼‰
            await new Promise(resolve => setTimeout(resolve, Math.random() * 500 + 200));

            // éšæœºé€šè¿‡ç‡ï¼ˆå®é™…ç¯å¢ƒä¸­ä¼šçœŸå®è¿è¡Œæµ‹è¯•ï¼‰
            const pass = Math.random() > 0.1; // 90% é€šè¿‡ç‡

            if (pass) {
                log(`âœ“ ${testName} - é€šè¿‡`, 'success');
                return { success: true, message: 'âœ“ æµ‹è¯•é€šè¿‡' };
            } else {
                log(`âœ— ${testName} - å¤±è´¥`, 'error');
                return { success: false, message: 'âœ— æµ‹è¯•å¤±è´¥ï¼šæ–­è¨€é”™è¯¯' };
            }
        }

        async function runSuite(suiteIndex) {
            const suite = testSuites[suiteIndex];
            const suiteBadge = document.querySelectorAll('.test-suite-badge')[suiteIndex];
            const suiteItems = document.querySelectorAll('.test-items')[suiteIndex];
            const testItems = suiteItems.querySelectorAll('.test-item');

            suiteBadge.className = 'test-suite-badge badge-running';
            suiteBadge.textContent = 'è¿è¡Œä¸­';
            log(`å¼€å§‹æµ‹è¯•å¥—ä»¶: ${suite.name}`, 'info');

            let passCount = 0;
            let failCount = 0;

            for (let i = 0; i < suite.tests.length; i++) {
                const item = testItems[i];
                const statusSpan = item.querySelector('.test-item-status');
                const detailsDiv = item.querySelector('.test-details');

                statusSpan.className = 'test-item-status badge-running';
                statusSpan.textContent = 'è¿è¡Œä¸­';

                const result = await runTest(suiteIndex, i);

                if (result.success) {
                    passCount++;
                    item.classList.add('pass');
                    item.classList.remove('fail');
                    statusSpan.className = 'test-item-status badge-pass';
                    statusSpan.innerHTML = '<span class="status-icon-pass">âœ“</span> é€šè¿‡';
                } else {
                    failCount++;
                    item.classList.add('fail');
                    item.classList.remove('pass');
                    statusSpan.className = 'test-item-status badge-fail';
                    statusSpan.innerHTML = '<span class="status-icon-fail">âœ—</span> å¤±è´¥';
                }

                detailsDiv.textContent = result.message;

                // æ›´æ–°è¿›åº¦æ¡
                const totalTests = testSuites.reduce((sum, s) => sum + s.tests.length, 0);
                const completedTests = testSuites.slice(0, suiteIndex).reduce((sum, s) => sum + s.tests.length, 0) + i + 1;
                document.getElementById('progressBar').style.width = `${(completedTests / totalTests) * 100}%`;
            }

            suiteBadge.className = failCount === 0 ? 'test-suite-badge badge-pass' : 'test-suite-badge badge-fail';
            suiteBadge.textContent = failCount === 0 ? `âœ“ ${passCount}/${suite.tests.length}` : `âœ— ${failCount} å¤±è´¥`;

            log(`${suite.name} å®Œæˆ: ${passCount} é€šè¿‡, ${failCount} å¤±è´¥`, failCount === 0 ? 'success' : 'error');

            return { passCount, failCount };
        }

        async function runAllTests() {
            const runBtn = document.getElementById('runAllBtn');
            const overallStatus = document.getElementById('overallStatus');

            runBtn.disabled = true;
            overallStatus.className = 'test-status status-running';
            overallStatus.textContent = 'è¿è¡Œä¸­';

            consoleLines = [];
            log('========== å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯• ==========', 'info');
            log(`æ—¶é—´: ${new Date().toLocaleString()}`, 'info');

            let totalPass = 0;
            let totalFail = 0;

            for (let i = 0; i < testSuites.length; i++) {
                const result = await runSuite(i);
                totalPass += result.passCount;
                totalFail += result.failCount;
            }

            // æ›´æ–°æ€»ç»“
            document.getElementById('totalSuites').textContent = testSuites.length;
            document.getElementById('passCount').textContent = totalPass;
            document.getElementById('failCount').textContent = totalFail;
            document.getElementById('passRate').textContent = `${Math.round((totalPass / (totalPass + totalFail)) * 100)}%`;
            document.getElementById('summary').classList.add('show');

            overallStatus.className = totalFail === 0 ? 'test-status status-pass' : 'test-status status-fail';
            overallStatus.textContent = totalFail === 0 ? 'å…¨éƒ¨é€šè¿‡' : `${totalFail} å¤±è´¥`;

            runBtn.disabled = false;
            runBtn.innerHTML = '<span>â–¶ï¸</span><span>é‡æ–°è¿è¡Œ</span>';

            log('========== æµ‹è¯•å®Œæˆ ==========', 'info');
            log(`æ€»è®¡: ${totalPass} é€šè¿‡, ${totalFail} å¤±è´¥`, totalFail === 0 ? 'success' : 'error');
            log(`é€šè¿‡ç‡: ${Math.round((totalPass / (totalPass + totalFail)) * 100)}%`, 'info');
        }

        // åˆå§‹åŒ–æµ‹è¯•å¥—ä»¶UI
        function initializeUI() {
            const testResultsDiv = document.getElementById('testResults');

            testSuites.forEach((suite, suiteIndex) => {
                const suiteDiv = document.createElement('div');
                suiteDiv.className = 'test-suite';

                suiteDiv.innerHTML = `
                    <div class="test-suite-header" onclick="toggleSuite(${suiteIndex})">
                        <h3>
                            <span>${suite.icon}</span>
                            <span>${suite.name}</span>
                            <span class="test-suite-badge badge-pending" id="badge${suiteIndex}">å¾…æµ‹è¯•</span>
                        </h3>
                        <span class="chevron">â–¼</span>
                    </div>
                    <div class="test-items">
                        ${suite.tests.map((test, testIndex) => `
                            <div class="test-item">
                                <div class="test-item-header">
                                    <h4>${test}</h4>
                                    <span class="test-item-status badge-pending">å¾…æµ‹è¯•</span>
                                </div>
                                <div class="test-details">ç­‰å¾…è¿è¡Œ...</div>
                            </div>
                        `).join('')}
                    </div>
                `;

                testResultsDiv.appendChild(suiteDiv);
            });

            log('æµ‹è¯•ä»ªè¡¨æ¿å·²åˆå§‹åŒ–', 'info');
            log(`åŠ è½½äº† ${testSuites.length} ä¸ªæµ‹è¯•å¥—ä»¶`, 'info');
            log(`æ€»è®¡ ${testSuites.reduce((sum, s) => sum + s.tests.length, 0)} ä¸ªæµ‹è¯•`, 'info');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        initializeUI();
    </script>
</body>
</html>
