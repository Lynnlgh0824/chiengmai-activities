<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç±»ç­›é€‰è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 0; }
        pre {
            background: white;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-ok { background: #d1e7dd; color: #0f5132; }
        .status-error { background: #f8d7da; color: #842029; }
        .status-warning { background: #fff3cd; color: #856404; }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #5568d3; }
    </style>
</head>
<body>
    <h1>ğŸ” åˆ†ç±»ç­›é€‰è¯Šæ–­å·¥å…·</h1>

    <div class="section">
        <h2>1. ä¸»é¡µé¢çŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="checkMainPage()">æ£€æŸ¥ä¸»é¡µé¢çš„åˆ†ç±»ç­›é€‰</button>
        <pre id="mainPageResult">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</pre>
    </div>

    <div class="section">
        <h2>2. æ£€æŸ¥APIæ•°æ®</h2>
        <button onclick="checkAPIData()">æ£€æŸ¥APIè¿”å›çš„åˆ†ç±»æ•°æ®</button>
        <pre id="apiDataResult">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</pre>
    </div>

    <div class="section">
        <h2>3. å¿«é€Ÿä¿®å¤</h2>
        <button onclick="applyFix()">åº”ç”¨ä¿®å¤</button>
        <pre id="fixResult">ç‚¹å‡»æŒ‰é’®åº”ç”¨ä¿®å¤...</pre>
    </div>

    <script>
        async function checkMainPage() {
            const result = document.getElementById('mainPageResult');
            result.textContent = 'æ­£åœ¨æ£€æŸ¥...';

            try {
                // åŠ è½½ä¸»é¡µé¢
                const response = await fetch('http://localhost:3000');
                const html = await response.text();

                // æ£€æŸ¥categoryChipså…ƒç´ 
                const chipMatch = html.match(/<div class="filter-chips" id="categoryChips">([\s\S]*?)<\/div>/);

                let output = 'âœ… ä¸»é¡µé¢åŠ è½½æˆåŠŸ\n\n';

                if (chipMatch) {
                    const chipsHTML = chipMatch[1];
                    const chipCount = (chipsHTML.match(/filter-chip/g) || []).length;

                    output += `ğŸ“Š categoryChipså…ƒç´ :\n`;
                    output += `   - æ‰¾åˆ° ${chipCount} ä¸ªåˆ†ç±»chip\n`;

                    if (chipCount === 1) {
                        output += `\nâš ï¸  è­¦å‘Š: åªæœ‰"å…¨éƒ¨"é€‰é¡¹ï¼Œæ²¡æœ‰å…¶ä»–åˆ†ç±»\n`;
                        output += `   è¿™è¯´æ˜ initCategoryFilters() æ‰§è¡Œæ—¶ allActivities ä¸ºç©º\n`;
                    } else {
                        output += `\nâœ… æ­£å¸¸: æ‰¾åˆ°å¤šä¸ªåˆ†ç±»é€‰é¡¹\n`;
                    }

                    output += `\nå½“å‰HTML:\n${chipsHTML.substring(0, 200)}...`;
                } else {
                    output += `âŒ æœªæ‰¾åˆ° categoryChips å…ƒç´ \n`;
                }

                result.textContent = output;
            } catch (error) {
                result.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        async function checkAPIData() {
            const result = document.getElementById('apiDataResult');
            result.textContent = 'æ­£åœ¨æ£€æŸ¥API...';

            try {
                const response = await fetch('http://localhost:3000/api/activities?limit=1000');
                const data = await response.json();

                let output = '';

                if (data.success && data.data) {
                    const categories = [...new Set(data.data.map(item => item.category))];

                    output += `âœ… APIè¿”å›æˆåŠŸ\n\n`;
                    output += `ğŸ“Š æ•°æ®ç»Ÿè®¡:\n`;
                    output += `   - æ€»æ´»åŠ¨æ•°: ${data.data.length}\n`;
                    output += `   - åˆ†ç±»æ•°: ${categories.length}\n\n`;
                    output += `ğŸ“‹ æ‰€æœ‰åˆ†ç±»:\n`;
                    categories.forEach((cat, i) => {
                        const count = data.data.filter(item => item.category === cat).length;
                        output += `   ${i + 1}. ${cat} (${count}ä¸ªæ´»åŠ¨)\n`;
                    });

                    if (categories.includes('éŸ³ä¹')) {
                        output += `\nâœ… "éŸ³ä¹"åˆ†ç±»å­˜åœ¨äºAPIæ•°æ®ä¸­\n`;
                    } else {
                        output += `\nâŒ "éŸ³ä¹"åˆ†ç±»ä¸å­˜åœ¨äºAPIæ•°æ®ä¸­\n`;
                    }
                } else {
                    output = `âŒ APIè¿”å›å¤±è´¥: ${JSON.stringify(data)}`;
                }

                result.textContent = output;
            } catch (error) {
                result.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        async function applyFix() {
            const result = document.getElementById('fixResult');
            result.textContent = 'æ­£åœ¨ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ...';

            const fixes = [];

            // è¯Šæ–­é—®é¢˜
            try {
                const response = await fetch('http://localhost:3000');
                const html = await response.text();

                const chipMatch = html.match(/<div class="filter-chips" id="categoryChips">([\s\S]*?)<\/div>/);
                if (chipMatch) {
                    const chipCount = (chipMatch[1].match(/filter-chip/g) || []).length;

                    if (chipCount === 1) {
                        fixes.push('é—®é¢˜è¯Šæ–­: initCategoryFilters()æ‰§è¡Œæ—¶allActivitiesä¸ºç©º');
                        fixes.push('');
                        fixes.push('å¯èƒ½çš„åŸå› :');
                        fixes.push('1. APIè¯·æ±‚å°šæœªå®Œæˆæ—¶å°±å·²ç»è°ƒç”¨äº†initCategoryFilters()');
                        fixes.push('2. allActivitieså˜é‡ä½œç”¨åŸŸé—®é¢˜');
                        fixes.push('3. æ•°æ®åŠ è½½æµç¨‹æœ‰é”™è¯¯å¤„ç†å¯¼è‡´æå‰é€€å‡º');
                        fixes.push('');
                        fixes.push('å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ:');
                        fixes.push('');
                        fixes.push('æ–¹æ¡ˆ1: åœ¨APIå“åº”æˆåŠŸåå»¶è¿Ÿè°ƒç”¨initCategoryFilters()');
                        fixes.push('  åœ¨ public/index.html ç¬¬2402è¡Œé™„è¿‘æ·»åŠ :');
                        fixes.push('  setTimeout(() => initCategoryFilters(), 100);');
                        fixes.push('');
                        fixes.push('æ–¹æ¡ˆ2: åœ¨initCategoryFilters()ä¸­æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥');
                        fixes.push('  function initCategoryFilters() {');
                        fixes.push('    if (!allActivities || allActivities.length === 0) {');
                        fixes.push('      console.warn("âš ï¸ allActivitiesä¸ºç©ºï¼Œç¨åé‡è¯•");');
                        fixes.push('      setTimeout(initCategoryFilters, 500);');
                        fixes.push('      return;');
                        fixes.push('    }');
                        fixes.push('    // åŸæœ‰ä»£ç ...');
                        fixes.push('  }');
                    } else {
                        fixes.push('âœ… åˆ†ç±»ç­›é€‰æ­£å¸¸ï¼Œæ— éœ€ä¿®å¤');
                    }
                }

                result.textContent = fixes.join('\n');
            } catch (error) {
                result.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // è‡ªåŠ¨è¿è¡Œæ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkMainPage, 500);
        });
    </script>
</body>
</html>
